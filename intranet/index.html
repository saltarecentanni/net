<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="app-version" content="2.7.0">
    <title>Tiesse Matrix Network</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .sticky-col { 
            position: sticky; 
            left: 0; 
            z-index: 20; 
        }
        thead th.sticky-col {
            z-index: 30;
        }
        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            transition: all 0.3s;
        }
        .sync-saved { background: #22c55e; color: white; }
        .sync-info { background: #3b82f6; color: white; }
        
        /* Tab styles */
        .tab-btn {
            padding: 12px 24px;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            color: #64748b;
        }
        .tab-btn:hover {
            color: #3b82f6;
            background: #f1f5f9;
        }
        .tab-btn.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: #eff6ff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        /* Drag to scroll */
        .drag-scroll {
            cursor: grab;
            user-select: none;
        }
        .drag-scroll:active, .drag-scroll.dragging {
            cursor: grabbing;
        }
        /* Print styles */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            body * { visibility: hidden; }
            .print-area, .print-area * { visibility: visible; }
            .print-area { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
            .print-hide-id { display: none !important; }
            .print-hide-empty:empty { display: none !important; }
            .drag-scroll { overflow: visible !important; max-height: none !important; cursor: default; }
            table { font-size: 9px !important; border-collapse: collapse !important; }
            table th, table td { 
                border: 1px solid #94a3b8 !important; 
                padding: 3px 5px !important;
                background: white !important;
            }
            table thead th { background-color: #e2e8f0 !important; font-weight: bold !important; }
            .bg-slate-100, .bg-slate-50, .bg-amber-50 { background: transparent !important; }
            span[style*="text-shadow"] { text-shadow: none !important; }
            @page { size: landscape; margin: 6mm; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">
    <div id="syncIndicator" class="sync-indicator" style="display:none;"></div>
    
    <div class="w-full px-4 py-4">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800 mb-1">Tiesse Matrix Network</h1>
                    <p class="text-slate-600 text-sm">Visual matrix of network devices, ports and connections</p>
                </div>
                <div class="text-right text-xs text-slate-500">
                    <div>üíæ Auto-save: LocalStorage + Server</div>
                    <div class="text-slate-600 mt-1">Version: <span id="appVersion" class="font-semibold">v2.5.0</span></div>
                </div>
            </div>
        </div>

        <script>
            (function(){
                var meta = document.querySelector('meta[name="app-version"]');
                var ver = meta ? meta.getAttribute('content') : '';
                var el = document.getElementById('appVersion');
                if (el) el.textContent = ver ? ('v' + ver) : '';
            })();
        </script>

        <!-- Actions Bar -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
            <div class="flex flex-wrap gap-2 items-center justify-between">
                <h2 class="text-lg font-bold text-slate-800">Actions</h2>
                <div class="flex flex-wrap gap-2">
                    <button onclick="exportExcel()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-1.5 px-3 rounded-lg text-sm">
                        üìä Export to Excel
                    </button>
                    <button onclick="exportJSON()" class="bg-slate-500 hover:bg-slate-600 text-white font-semibold py-1.5 px-3 rounded-lg text-sm">
                        üíæ Export JSON
                    </button>
                    <input type="file" id="importFile" accept=".json" onchange="importData(event)" class="hidden">
                    <button onclick="document.getElementById('importFile').click()" class="bg-slate-500 hover:bg-slate-600 text-white font-semibold py-1.5 px-3 rounded-lg text-sm">
                        üì• Import JSON
                    </button>
                    <button onclick="clearAll()" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-1.5 px-3 rounded-lg text-sm">
                        Clear All
                    </button>
                </div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="bg-white rounded-t-xl shadow-lg">
            <div class="flex border-b overflow-x-auto">
                <button class="tab-btn active" onclick="switchTab('devices')" id="tab-devices">
                    üì± Devices
                </button>
                <button class="tab-btn" onclick="switchTab('active')" id="tab-active">
                    ‚ö° Active Connections
                </button>
                <button class="tab-btn" onclick="switchTab('matrix')" id="tab-matrix">
                    üîó Matrix
                </button>
                <button class="tab-btn" onclick="switchTab('help')" id="tab-help">
                    ‚ùì Help
                </button>
            </div>
        </div>

        <!-- Tab Contents -->
        <div class="bg-white rounded-b-xl shadow-lg p-4 mb-4">
            
            <!-- Tab 1: Devices -->
            <div id="content-devices" class="tab-content active">
                <!-- Add Device Form -->
                <div class="bg-slate-50 rounded-lg p-3 mb-4">
                    <h2 class="text-lg font-bold text-slate-800 mb-3">Add Device</h2>
                    <input type="hidden" id="deviceEditId" value="">
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-12 gap-2 items-end">
                        <div class="col-span-1">
                            <label class="text-xs text-slate-600 mb-1 block">Rack ID *</label>
                            <input type="text" id="rackId" list="rackIdList" placeholder="Rack1" 
                                class="w-full px-3 py-1.5 border-2 border-blue-400 rounded-lg focus:ring-2 focus:ring-blue-500 font-bold text-center text-sm">
                            <datalist id="rackIdList"></datalist>
                        </div>
                        <div class="col-span-1">
                            <label class="text-xs text-slate-600 mb-1 block">Order *</label>
                            <input type="number" id="deviceOrder" placeholder="01" min="1" value="1"
                                class="w-full px-3 py-1.5 border-2 border-blue-400 rounded-lg focus:ring-2 focus:ring-blue-500 font-bold text-center text-sm">
                        </div>
                        <div class="col-span-2">
                            <label class="text-xs text-slate-600 mb-1 block">Device Name *</label>
                            <input type="text" id="deviceName" placeholder="e.g., Router-GW" 
                                class="w-full px-3 py-1.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                        <div class="col-span-2">
                            <label class="text-xs text-slate-600 mb-1 block">Brand/Model</label>
                            <input type="text" id="deviceBrandModel" placeholder="e.g., HPE Aruba 2930F" 
                                class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm">
                        </div>
                        <div class="col-span-1">
                            <label class="text-xs text-slate-600 mb-1 block">Type</label>
                            <select id="deviceType" class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm">
                                <option value="router">Router</option>
                                <option value="switch">Switch</option>
                                <option value="patch">Patch Panel</option>
                                <option value="firewall">Firewall</option>
                                <option value="server">Server</option>
                                <option value="wifi">WiFi AP</option>
                                <option value="isp">ISP/Provider</option>
                                <option value="router_wifi">Router Wifi</option>
                                <option value="others">Others</option>
                            </select>
                        </div>
                        <div class="col-span-1">
                            <label class="text-xs text-slate-600 mb-1 block">Status</label>
                            <select id="deviceStatus" class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm">
                                <option value="active">Active</option>
                                <option value="disabled">Disabled</option>
                            </select>
                        </div>
                        <div class="col-span-2">
                            <label class="text-xs text-slate-600 mb-1 block">Service</label>
                            <input type="text" id="deviceService" placeholder="DHCP, DNS, Gateway" 
                                class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm">
                        </div>
                        <div class="col-span-2 flex gap-2">
                            <button onclick="saveDevice()" 
                                class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-1.5 px-3 rounded-lg text-sm" id="saveDeviceButton">
                                Add Device
                            </button>
                            <button onclick="clearDeviceForm()" 
                                class="bg-slate-400 hover:bg-slate-500 text-white font-semibold py-1.5 px-3 rounded-lg text-sm">
                                Clear
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mt-2">
                        <div>
                            <label class="text-xs text-slate-600 mb-1 block">Addresses (Network, IP, VLAN)</label>
                            <textarea id="deviceAddresses" placeholder="192.168.1.0/24, 192.168.1.1, 10" rows="1"
                                oninput="autoResizeTextarea(this)"
                                class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm"></textarea>
                        </div>
                        <div class="border border-slate-200 rounded-lg p-2 bg-white">
                            <div class="flex items-center justify-between mb-1">
                                <h3 class="text-xs font-bold text-slate-700">Port Configuration</h3>
                                <button onclick="addPortTypeField()" type="button"
                                    class="text-xs font-semibold text-blue-500 hover:text-blue-700">+ Add Port</button>
                            </div>
                            <div id="portTypeQuantityContainer" class="space-y-1"></div>
                        </div>
                        <div>
                            <label class="text-xs text-slate-600 mb-1 block">Notes</label>
                            <textarea id="deviceNotes" placeholder="Notes (optional)" rows="1"
                                oninput="autoResizeTextarea(this)"
                                class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Devices List -->
                <div>
                    <h2 class="text-lg font-bold text-slate-800 mb-3">Devices List</h2>
                    <div class="overflow-x-auto" id="devicesListContainer">
                        <div class="text-center text-slate-500 py-8">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Tab 2: Active Connections (with connection form) -->
            <div id="content-active" class="tab-content">
                <!-- Connection Form -->
                <div class="bg-slate-50 rounded-lg p-3 mb-4">
                    <h2 class="text-lg font-bold text-slate-800 mb-3" id="connectionFormTitle">Add Connection</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-12 gap-2 items-end">
                        <div class="col-span-2">
                            <label class="text-xs text-slate-600 mb-1 block">Source Device</label>
                            <select id="fromDevice" onchange="updateFromPorts()" 
                                class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm">
                                <option value="">Select source</option>
                            </select>
                        </div>
                        <div class="col-span-1">
                            <label class="text-xs text-slate-600 mb-1 block">Source Port</label>
                            <select id="fromPort" class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm">
                                <option value="">Port</option>
                            </select>
                        </div>
                        <div class="col-span-2">
                            <label class="text-xs text-slate-600 mb-1 block">Destination Device</label>
                            <select id="toDevice" onchange="updateToPorts(); toggleExternalDest()" 
                                class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm">
                                <option value="">Select destination</option>
                            </select>
                        </div>
                        <div class="col-span-1" id="toPortContainer">
                            <label class="text-xs text-slate-600 mb-1 block">Dest Port</label>
                            <select id="toPort" class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm">
                                <option value="">Port</option>
                            </select>
                        </div>
                        <div class="col-span-3 hidden" id="externalDestContainer">
                            <label class="text-xs text-slate-600 mb-1 block">External Destination</label>
                            <input type="text" id="externalDest" placeholder="e.g. Fiber Optic TIM, Internet WAN, ISP Link"
                                class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm">
                        </div>
                        <div class="col-span-1">
                            <label class="text-xs text-slate-600 mb-1 block">Type</label>
                            <select id="connType" class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm">
                                <option value="lan">LAN</option>
                                <option value="wan">WAN/Internet</option>
                                <option value="dmz">DMZ</option>
                                <option value="trunk">Trunk/Uplink</option>
                                <option value="management">Management</option>
                                <option value="backup">Backup</option>
                                <option value="fiber">Fiber Optic</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="col-span-1">
                            <label class="text-xs text-slate-600 mb-1 block">Status</label>
                            <select id="connStatus" class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm">
                                <option value="active">Active</option>
                                <option value="disabled">Disabled</option>
                            </select>
                        </div>
                        <div class="col-span-1">
                            <label class="text-xs text-slate-600 mb-1 block">Cable ID</label>
                            <input type="text" id="cableMarker" maxlength="5" placeholder="1, A"
                                class="w-full px-2 py-1.5 border border-slate-300 rounded-lg text-sm">
                        </div>
                        <div class="col-span-1">
                            <label class="text-xs text-slate-600 mb-1 block">Color</label>
                            <select id="cableColor" class="w-full px-2 py-1.5 border border-slate-300 rounded-lg text-sm">
                                <option value="">None</option>
                                <option value="#000000">Black</option>
                                <option value="#ffffff">White</option>
                                <option value="#ef4444">Red</option>
                                <option value="#f97316">Orange</option>
                                <option value="#eab308">Yellow</option>
                                <option value="#8b4513">Brown</option>
                                <option value="#22c55e">Green</option>
                                <option value="#3b82f6">Blue</option>
                                <option value="#ec4899">Pink</option>
                                <option value="#6b7280">Gray</option>
                            </select>
                        </div>
                        <div class="col-span-2 flex gap-2">
                            <input type="hidden" id="connEditIndex" value="">
                            <button onclick="saveConnection()" 
                                class="flex-1 bg-green-500 hover:bg-green-600 text-white font-semibold py-1.5 px-3 rounded-lg text-sm" id="saveConnectionButton">
                                Add Connection
                            </button>
                            <button onclick="cancelConnectionEdit()" id="cancelConnectionButton"
                                class="hidden bg-slate-400 hover:bg-slate-500 text-white font-semibold py-1.5 px-3 rounded-lg text-sm">
                                Cancel
                            </button>
                        </div>
                    </div>
                    <div class="mt-2">
                        <textarea id="connNotes" placeholder="Notes (optional)" rows="1"
                            oninput="autoResizeTextarea(this)"
                            class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-sm"></textarea>
                    </div>
                </div>

                <!-- Connections List -->
                <div id="connectionsPrintArea">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <h2 class="text-lg font-bold text-slate-800">Active Connections</h2>
                            <p class="text-xs text-slate-500">All registered connections</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="text-sm font-bold text-slate-700">Total: <span id="connectionsCount">0</span> connections</span>
                            <button onclick="printConnections()" class="no-print bg-slate-500 hover:bg-slate-600 text-white font-semibold py-1 px-3 rounded-lg text-xs">
                                üñ®Ô∏è Print List
                            </button>
                        </div>
                    </div>
                    <div id="connectionsListContainer">
                        <div class="text-center text-slate-500 py-8">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: Matrix (only) -->
            <div id="content-matrix" class="tab-content">
                <div id="matrixPrintArea">
                    <div class="flex items-center justify-between mb-2">
                        <h2 class="text-lg font-bold text-slate-800">Connection Matrix</h2>
                        <div class="flex gap-2">
                            <button onclick="toggleMatrix()" id="toggleMatrixBtn" class="no-print bg-blue-500 hover:bg-blue-600 text-white font-semibold py-1 px-3 rounded-lg text-xs" style="display:none;">
                                Show All
                            </button>
                            <button onclick="printMatrix()" class="no-print bg-slate-500 hover:bg-slate-600 text-white font-semibold py-1 px-3 rounded-lg text-xs">
                                üñ®Ô∏è Print Matrix
                            </button>
                        </div>
                    </div>
                    <div class="overflow-auto drag-scroll" id="matrixContainer" style="max-height:70vh;">
                        <div class="text-center text-slate-500 py-8">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Tab 4: Help -->
            <div id="content-help" class="tab-content">
                <div class="max-w-4xl mx-auto">
                    <div class="text-center mb-6">
                        <h1 class="text-2xl font-bold text-slate-800 mb-2">üìö User Guide</h1>
                        <p class="text-slate-600">Complete step-by-step guide to manage your network infrastructure</p>
                    </div>

                    <!-- Quick Start -->
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded-r-lg">
                        <h2 class="text-lg font-bold text-blue-800 mb-2">üöÄ Quick Start</h2>
                        <p class="text-blue-700">This system helps you document your network infrastructure. You can add devices (routers, switches, servers), define their ports, and create connections between them. Everything is saved automatically!</p>
                    </div>

                    <!-- Section 1: Adding Devices -->
                    <div class="bg-white border border-slate-200 rounded-xl p-5 mb-4 shadow-sm">
                        <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">1</span>
                            Adding a New Device
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">a</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Go to the "Devices" tab</p>
                                    <p class="text-slate-600 text-sm">Click on the <span class="bg-slate-100 px-2 py-0.5 rounded">üì± Devices</span> button at the top of the page.</p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">b</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Fill in the Rack ID</p>
                                    <p class="text-slate-600 text-sm">This is the location identifier. Example: <code class="bg-amber-100 px-1 rounded">Rack-Network-01</code> or <code class="bg-amber-100 px-1 rounded">Server-Room-A</code>. Devices in the same rack will be grouped together.</p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">c</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Set the Order number</p>
                                    <p class="text-slate-600 text-sm">This is the position of the device within the rack. Use <code class="bg-amber-100 px-1 rounded">1</code> for the first device, <code class="bg-amber-100 px-1 rounded">2</code> for the second, etc.</p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">d</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Enter the Device Name</p>
                                    <p class="text-slate-600 text-sm">Give your device a unique, descriptive name. Examples: <code class="bg-amber-100 px-1 rounded">Tiesse-Wifi</code>, <code class="bg-amber-100 px-1 rounded">Main-Switch</code>, <code class="bg-amber-100 px-1 rounded">Huawei TIM</code></p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">e</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Add Port Configuration (Important!)</p>
                                    <p class="text-slate-600 text-sm">Click <span class="bg-blue-100 text-blue-700 px-2 py-0.5 rounded">+ Add Port</span> to define the device's ports. For each port type:</p>
                                    <ul class="text-slate-600 text-sm mt-2 ml-4 list-disc space-y-1">
                                        <li>Select the port type (Eth, GbE, SFP, etc.)</li>
                                        <li>Enter how many ports of this type</li>
                                        <li>Example: A switch with 24 Ethernet ports ‚Üí Type: <code class="bg-amber-100 px-1 rounded">Eth</code>, Qty: <code class="bg-amber-100 px-1 rounded">24</code></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">f</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Click "Add Device"</p>
                                    <p class="text-slate-600 text-sm">Press the blue <span class="bg-blue-500 text-white px-2 py-0.5 rounded text-xs">Add Device</span> button. Your device will appear in the list below!</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-green-50 border border-green-200 rounded-lg p-3 mt-4">
                            <p class="text-green-800 text-sm"><strong>üí° Tip:</strong> You can also add Brand/Model, IP Addresses, Service description, and Notes for better documentation.</p>
                        </div>
                    </div>

                    <!-- Section 2: Creating Connections -->
                    <div class="bg-white border border-slate-200 rounded-xl p-5 mb-4 shadow-sm">
                        <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <span class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">2</span>
                            Creating a Connection Between Devices
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">a</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Go to the "Active Connections" tab</p>
                                    <p class="text-slate-600 text-sm">Click on <span class="bg-slate-100 px-2 py-0.5 rounded">‚ö° Active Connections</span>. This is where you create and manage all connections.</p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">b</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Select the Source Device</p>
                                    <p class="text-slate-600 text-sm">Choose the device where the cable starts. Example: <code class="bg-amber-100 px-1 rounded">Tiesse-Wifi</code></p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">c</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Select the Source Port</p>
                                    <p class="text-slate-600 text-sm">Choose which port the cable is connected to. Example: <code class="bg-amber-100 px-1 rounded">eth1</code></p>
                                    <p class="text-slate-500 text-xs mt-1">‚ö†Ô∏è Only available (unused) ports will be shown!</p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">d</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Select the Destination Device</p>
                                    <p class="text-slate-600 text-sm">Choose where the cable goes. Example: <code class="bg-amber-100 px-1 rounded">Main-Switch</code></p>
                                    <p class="text-slate-500 text-xs mt-1">üí° For external connections (like ISP), select "External/Internet" and enter a description.</p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">e</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Select the Destination Port</p>
                                    <p class="text-slate-600 text-sm">Choose which port on the destination device. Example: <code class="bg-amber-100 px-1 rounded">eth13</code></p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">f</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Choose the Connection Type</p>
                                    <p class="text-slate-600 text-sm">Select what kind of connection this is:</p>
                                    <ul class="text-slate-600 text-sm mt-2 ml-4 list-disc space-y-1">
                                        <li><strong>LAN</strong> - Local network connection</li>
                                        <li><strong>WAN/Internet</strong> - Internet or external network</li>
                                        <li><strong>Trunk/Uplink</strong> - Connection between switches</li>
                                        <li><strong>Management</strong> - Administrative access</li>
                                        <li><strong>Fiber Optic</strong> - Fiber connections</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">g</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Add Cable ID and Color (Optional but Recommended)</p>
                                    <p class="text-slate-600 text-sm">If your cables have labels, enter the ID (e.g., <code class="bg-amber-100 px-1 rounded">A1</code>, <code class="bg-amber-100 px-1 rounded">15</code>). Select the cable color to help identify it physically.</p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="bg-slate-200 text-slate-700 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">h</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Click "Add Connection"</p>
                                    <p class="text-slate-600 text-sm">Press the green <span class="bg-green-500 text-white px-2 py-0.5 rounded text-xs">Add Connection</span> button. Done! ‚úÖ</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 3: Using the Matrix -->
                    <div class="bg-white border border-slate-200 rounded-xl p-5 mb-4 shadow-sm">
                        <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <span class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">3</span>
                            Understanding the Connection Matrix
                        </h2>
                        
                        <div class="space-y-4">
                            <p class="text-slate-600">The Matrix tab shows a visual grid of all your connections. Think of it like a spreadsheet where:</p>
                            
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <ul class="text-slate-700 space-y-2">
                                    <li>üìä <strong>Rows</strong> = Source devices (where cables come FROM)</li>
                                    <li>üìä <strong>Columns</strong> = Destination devices (where cables go TO)</li>
                                    <li>üîµ <strong>Colored cells</strong> = There is a connection between those two devices</li>
                                    <li>‚¨ú <strong>Empty cells</strong> = No connection exists</li>
                                </ul>
                            </div>

                            <div class="flex items-start gap-3 mt-4">
                                <span class="text-2xl">üëÜ</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Click on any colored cell to edit that connection!</p>
                                    <p class="text-slate-600 text-sm">The cell shows: connection type, port names, and cable ID if defined.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 4: Editing and Deleting -->
                    <div class="bg-white border border-slate-200 rounded-xl p-5 mb-4 shadow-sm">
                        <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <span class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">4</span>
                            Editing and Deleting
                        </h2>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h3 class="font-bold text-blue-800 mb-2">‚úèÔ∏è To Edit a Device:</h3>
                                <ol class="text-blue-700 text-sm space-y-1 list-decimal ml-4">
                                    <li>Go to <strong>Devices</strong> tab</li>
                                    <li>Find the device in the list</li>
                                    <li>Click the <strong>Edit</strong> button</li>
                                    <li>Make your changes</li>
                                    <li>Click <strong>Update Device</strong></li>
                                </ol>
                            </div>

                            <div class="bg-green-50 p-4 rounded-lg">
                                <h3 class="font-bold text-green-800 mb-2">‚úèÔ∏è To Edit a Connection:</h3>
                                <ol class="text-green-700 text-sm space-y-1 list-decimal ml-4">
                                    <li>Go to <strong>Active Connections</strong> tab</li>
                                    <li>Find the connection in the list</li>
                                    <li>Click the <strong>Edit</strong> button</li>
                                    <li>Make your changes</li>
                                    <li>Click <strong>Update Connection</strong></li>
                                </ol>
                            </div>

                            <div class="bg-red-50 p-4 rounded-lg md:col-span-2">
                                <h3 class="font-bold text-red-800 mb-2">üóëÔ∏è To Delete:</h3>
                                <p class="text-red-700 text-sm">Click the <strong>Del</strong> button next to any device or connection. You will be asked to confirm before deletion.</p>
                                <p class="text-red-600 text-xs mt-2">‚ö†Ô∏è Warning: Deleting a device will also delete ALL its connections!</p>
                            </div>
                        </div>
                    </div>

                    <!-- Section 5: Export and Import -->
                    <div class="bg-white border border-slate-200 rounded-xl p-5 mb-4 shadow-sm">
                        <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <span class="bg-indigo-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">5</span>
                            Exporting and Importing Data
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="flex items-start gap-3">
                                <span class="text-2xl">üìä</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Export to Excel</p>
                                    <p class="text-slate-600 text-sm">Click <span class="bg-indigo-500 text-white px-2 py-0.5 rounded text-xs">üìä Export to Excel</span> in the Actions bar. Creates a spreadsheet with 3 sheets: Devices, Connections, and Matrix.</p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="text-2xl">üíæ</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Export to JSON</p>
                                    <p class="text-slate-600 text-sm">Click <span class="bg-slate-500 text-white px-2 py-0.5 rounded text-xs">üíæ Export JSON</span> to download a backup file. Use this to restore your data later or transfer to another computer.</p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="text-2xl">üì•</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Import from JSON</p>
                                    <p class="text-slate-600 text-sm">Click <span class="bg-slate-500 text-white px-2 py-0.5 rounded text-xs">üì• Import JSON</span> and select a previously exported JSON file. This will replace all current data!</p>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <span class="text-2xl">üñ®Ô∏è</span>
                                <div>
                                    <p class="font-semibold text-slate-700">Printing</p>
                                    <p class="text-slate-600 text-sm">Use the <span class="bg-slate-500 text-white px-2 py-0.5 rounded text-xs">üñ®Ô∏è Print</span> buttons in Matrix or Active Connections tabs to print documentation.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 6: Understanding the Interface -->
                    <div class="bg-white border border-slate-200 rounded-xl p-5 mb-4 shadow-sm">
                        <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <span class="bg-teal-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">6</span>
                            Understanding Colors and Symbols
                        </h2>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h3 class="font-bold text-slate-700 mb-2">Connection Types:</h3>
                                <div class="space-y-1 text-sm">
                                    <div class="flex items-center gap-2"><span class="w-4 h-4 rounded" style="background:#3b82f6"></span> LAN (Blue)</div>
                                    <div class="flex items-center gap-2"><span class="w-4 h-4 rounded" style="background:#ef4444"></span> WAN/Internet (Red)</div>
                                    <div class="flex items-center gap-2"><span class="w-4 h-4 rounded" style="background:#f97316"></span> DMZ (Orange)</div>
                                    <div class="flex items-center gap-2"><span class="w-4 h-4 rounded" style="background:#22c55e"></span> Trunk/Uplink (Green)</div>
                                    <div class="flex items-center gap-2"><span class="w-4 h-4 rounded" style="background:#8b5cf6"></span> Management (Purple)</div>
                                    <div class="flex items-center gap-2"><span class="w-4 h-4 rounded" style="background:#eab308"></span> Backup (Yellow)</div>
                                    <div class="flex items-center gap-2"><span class="w-4 h-4 rounded" style="background:#06b6d4"></span> Fiber Optic (Cyan)</div>
                                </div>
                            </div>

                            <div>
                                <h3 class="font-bold text-slate-700 mb-2">Status Indicators:</h3>
                                <div class="space-y-1 text-sm">
                                    <div class="flex items-center gap-2"><span class="px-2 py-0.5 rounded bg-green-100 text-green-800 text-xs">Active</span> Device/connection is working</div>
                                    <div class="flex items-center gap-2"><span class="px-2 py-0.5 rounded bg-red-100 text-red-800 text-xs">Disabled</span> Device/connection is off</div>
                                </div>
                                
                                <h3 class="font-bold text-slate-700 mb-2 mt-4">Matrix Headers:</h3>
                                <div class="space-y-1 text-sm">
                                    <div>üè∑Ô∏è Colored border = Rack identifier</div>
                                    <div>üî¢ Number in circle = Position in rack</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FAQ Section -->
                    <div class="bg-amber-50 border border-amber-200 rounded-xl p-5 mb-4">
                        <h2 class="text-xl font-bold text-amber-800 mb-4">‚ùì Frequently Asked Questions</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <p class="font-semibold text-amber-900">Q: Is my data saved automatically?</p>
                                <p class="text-amber-800 text-sm">A: Yes! Data is saved to your browser (LocalStorage) and to the server automatically every time you make a change.</p>
                            </div>
                            
                            <div>
                                <p class="font-semibold text-amber-900">Q: Can multiple people use this at the same time?</p>
                                <p class="text-amber-800 text-sm">A: Yes, if you're running the PHP server. All users on the network can access it. Note: The last person to save will overwrite previous changes.</p>
                            </div>
                            
                            <div>
                                <p class="font-semibold text-amber-900">Q: I don't see a port I need. What do I do?</p>
                                <p class="text-amber-800 text-sm">A: Go to Devices tab, find your device, click Edit, and add more ports using the "+ Add Port" button.</p>
                            </div>
                            
                            <div>
                                <p class="font-semibold text-amber-900">Q: How do I backup my data?</p>
                                <p class="text-amber-800 text-sm">A: Click "Export JSON" regularly. Store the downloaded file in a safe place. You can restore it anytime using "Import JSON".</p>
                            </div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="text-center text-slate-500 text-sm py-4">
                        <p>Tiesse Matrix Network v2.7.0 | Need more help? Contact your system administrator.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load external JavaScript modules -->
    <script src="js/app.js"></script>
    <script src="js/ui-updates.js"></script>
    
    <!-- Update connections count when list updates -->
    <script>
        (function() {
            var origUpdateConnList = window.updateConnectionsList;
            window.updateConnectionsList = function() {
                origUpdateConnList.apply(this, arguments);
                var countEl = document.getElementById('connectionsCount');
                if (countEl && window.appState) {
                    countEl.textContent = appState.connections.length;
                }
            };
        })();
    </script>
</body>
</html>
