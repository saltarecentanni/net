<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="app-version" content="3.4.0">
    <title>TIESSE Matrix Network - Tiesse S.P.A.</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='15' fill='%231e40af'/><circle cx='25' cy='25' r='8' fill='%2360a5fa'/><circle cx='75' cy='25' r='8' fill='%2360a5fa'/><circle cx='25' cy='75' r='8' fill='%2360a5fa'/><circle cx='75' cy='75' r='8' fill='%2360a5fa'/><circle cx='50' cy='50' r='10' fill='%23fbbf24'/><line x1='25' y1='25' x2='50' y2='50' stroke='%2393c5fd' stroke-width='3'/><line x1='75' y1='25' x2='50' y2='50' stroke='%2393c5fd' stroke-width='3'/><line x1='25' y1='75' x2='50' y2='50' stroke='%2393c5fd' stroke-width='3'/><line x1='75' y1='75' x2='50' y2='50' stroke='%2393c5fd' stroke-width='3'/></svg>">
    <!-- Local libraries for offline/intranet use -->
    <script src="assets/vendor/tailwind.min.js"></script>
    <script src="assets/vendor/xlsx.full.min.js"></script>
    <!-- SweetAlert2 para modais -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Custom CSS with CSS Variables (v3.3.0) -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">
    <div id="syncIndicator" class="sync-indicator" style="display:none;"></div>
    
    <div class="w-full px-4 py-4">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <!-- Logo Tiesse -->
                    <img src="assets/logoTiesse.png" alt="Tiesse S.P.A." class="h-8 w-auto">
                    <div>
                        <div class="flex items-baseline gap-2">
                            <h1 class="text-2xl font-bold text-slate-800">Matrix Network</h1>
                            <span class="text-xs text-slate-400 font-medium">by Tiesse S.P.A.</span>
                        </div>
                        <p class="text-slate-600 text-sm">Gestione visuale di dispositivi di rete, porte e connessioni</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <!-- Auth Controls -->
                    <span id="userInfo" class="text-sm font-semibold text-green-600" style="display:none;"></span>
                    <button id="loginBtn" onclick="Auth.showLoginModal()" class="view-mode-only bg-blue-500 hover:bg-blue-600 text-white font-semibold py-1.5 px-4 rounded-lg text-sm">
                        üîì Edit Mode
                    </button>
                    <button id="logoutBtn" onclick="Auth.logout()" class="edit-mode-only bg-slate-500 hover:bg-slate-600 text-white font-semibold py-1.5 px-3 rounded-lg text-sm" style="display:none;">
                        üîí Logout
                    </button>
                    <button onclick="switchTab('logs')" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-1.5 px-3 rounded-lg text-sm" title="Activity Logs">
                        üìã
                    </button>
                    <div class="text-right text-xs text-slate-500">
                        <div class="font-semibold text-slate-700">Tiesse S.P.A.</div>
                        <div class="text-slate-600">Versione: <span id="appVersion" class="font-semibold">v3.4.0</span></div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            (function(){
                var meta = document.querySelector('meta[name="app-version"]');
                var ver = meta ? meta.getAttribute('content') : '';
                var el = document.getElementById('appVersion');
                if (el) el.textContent = ver ? ('v' + ver) : '';
            })();
        </script>

        <!-- Actions Bar -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
            <div class="flex flex-wrap gap-2 items-center justify-between">
                <div class="flex items-center gap-4">
                    <h2 class="text-lg font-bold text-slate-800">Actions</h2>
                    <!-- Global Location Filter -->
                    <div class="flex items-center gap-2 bg-orange-50 border border-orange-300 rounded-lg px-2 py-1">
                        <select id="locationFilter" onchange="filterByLocation();" class="px-2 py-1 text-sm border-0 bg-transparent font-semibold text-orange-800 cursor-pointer focus:outline-none">
                            <option value="">üåê All Locations</option>
                        </select>
                        <span id="totalLocationsCount" class="bg-orange-600 text-white text-xs font-bold px-2 py-0.5 rounded-full">0</span>
                    </div>
                    <!-- Stats Counters -->
                    <div class="flex items-center gap-2">
                        <button onclick="switchTab('devices')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1.5 px-3 rounded-lg text-sm shadow-sm transition-all">
                            üì± <span id="totalDevicesCount">0</span> Devices
                        </button>
                        <button onclick="switchTab('active')" class="bg-green-500 hover:bg-green-600 text-white font-bold py-1.5 px-3 rounded-lg text-sm shadow-sm transition-all">
                            ‚ö° <span id="totalConnectionsCount">0</span> Connections
                        </button>
                    </div>
                </div>
                <div class="flex flex-wrap gap-2">
                    <!-- Edit Mode Only -->
                    <button onclick="saveNow()" class="edit-mode-only bg-green-600 hover:bg-green-700 text-white font-semibold py-1.5 px-3 rounded-lg text-sm" style="display:none;">
                        üíæ Save Now
                    </button>
                    <!-- Public -->
                    <button onclick="exportExcel()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-1.5 px-3 rounded-lg text-sm">
                        üìä Export to Excel
                    </button>
                    <button onclick="exportJSON()" class="bg-slate-500 hover:bg-slate-600 text-white font-semibold py-1.5 px-3 rounded-lg text-sm">
                        üíæ Export JSON
                    </button>
                    <!-- Edit Mode Only -->
                    <input type="file" id="importFile" accept=".json" onchange="importData(event)" class="hidden">
                    <button onclick="document.getElementById('importFile').click()" class="edit-mode-only bg-slate-500 hover:bg-slate-600 text-white font-semibold py-1.5 px-3 rounded-lg text-sm" style="display:none;">
                        üì• Import JSON
                    </button>
                    <button onclick="clearAll()" class="edit-mode-only bg-red-500 hover:bg-red-600 text-white font-semibold py-1.5 px-3 rounded-lg text-sm" style="display:none;">
                        Clear All
                    </button>
                </div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="bg-white rounded-t-xl shadow-lg">
            <div class="flex border-b overflow-x-auto">
                <button class="tab-btn active" onclick="switchTab('devices')" id="tab-devices">
                    üì± Devices
                </button>
                <button class="tab-btn" onclick="switchTab('active')" id="tab-active">
                    ‚ö° Active Connections
                </button>
                <button class="tab-btn" onclick="switchTab('drawio')" id="tab-drawio">
                    üó∫Ô∏è Topology
                </button>
                <button class="tab-btn" onclick="switchTab('matrix')" id="tab-matrix">
                    üìä Matrix
                </button>
                <button class="tab-btn" onclick="switchTab('floorplan')" id="tab-floorplan">
                    üè¢ Floor Plan
                </button>
                <button class="tab-btn" onclick="switchTab('help')" id="tab-help">
                    ‚ùì Help
                </button>
            </div>
        </div>

        <!-- Tab Contents -->
        <div class="bg-white rounded-b-xl shadow-lg p-4 mb-4">
            
            <!-- Tab 1: Devices -->
            <div id="content-devices" class="tab-content active">
                <!-- Add Device Form -->
                <div class="edit-mode-only bg-slate-50 rounded-lg p-3 mb-4" style="display:none;">
                    <h2 class="text-lg font-bold text-slate-800 mb-3">Add Device</h2>
                    <input type="hidden" id="deviceEditId" value="">
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 xl:grid-cols-12 gap-2 items-end">
                        <div class="col-span-2">
                            <label class="text-xs text-slate-600 mb-1 block">üìç Location *</label>
                            <div class="flex gap-1">
                                <select id="deviceLocation" class="flex-1 px-3 py-1.5 border-2 border-purple-400 rounded-lg focus:ring-2 focus:ring-purple-500 text-xs">
                                    <option value="">-- Select Location --</option>
                                </select>
                                <button type="button" onclick="openLocationManager()" title="Manage Locations" 
                                    class="px-2 py-1 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg text-xs font-bold transition-colors">‚öôÔ∏è</button>
                            </div>
                        </div>
                        <div class="col-span-1">
                            <!-- rackId nel codice, label visuale 'Group' per rack/uffici/sale/zone -->
                            <label class="text-xs text-slate-600 mb-1 block">üóÇÔ∏è Group *</label>
                            <input type="text" id="rackId" list="rackIdList" placeholder="Rack1, Standalone" 
                                class="w-full px-3 py-1.5 border-2 border-blue-400 rounded-lg focus:ring-2 focus:ring-blue-500 text-center text-xs">
                            <datalist id="rackIdList"></datalist>
                        </div>
                        <div class="col-span-1">
                            <label class="text-xs text-slate-600 mb-1 block">üî¢ Order *</label>
                            <div class="flex gap-1 items-center justify-center">
                                <input type="text" id="deviceOrder" placeholder="00" value="00" maxlength="2"
                                    class="w-10 px-1 py-1.5 border-2 border-blue-400 rounded-lg focus:ring-2 focus:ring-blue-500 text-center text-xs"
                                    onchange="formatDeviceOrder()" oninput="formatDeviceOrder()">
                                <div class="flex flex-col gap-0">
                                    <button type="button" onclick="adjustDeviceOrder(1)" class="px-1.5 py-0 text-[10px] bg-slate-200 hover:bg-slate-300 rounded-t border border-slate-300 leading-none h-3">‚ñ≤</button>
                                    <button type="button" onclick="adjustDeviceOrder(-1)" class="px-1.5 py-0 text-[10px] bg-slate-200 hover:bg-slate-300 rounded-b border border-t-0 border-slate-300 leading-none h-3">‚ñº</button>
                                </div>
                                <label class="flex items-center gap-0.5 px-1.5 py-1 bg-amber-50 border border-amber-300 rounded-lg cursor-pointer hover:bg-amber-100" title="Check if device is on back/rear of rack">
                                    <input type="checkbox" id="deviceRear" class="w-3 h-3 rounded border-amber-400 text-amber-600" onchange="toggleRearOrder()">
                                    <span class="text-xs font-bold text-amber-700">R</span><span class="text-[10px] text-amber-600">‚Ü©</span>
                                </label>
                            </div>
                        </div>
                        <div class="col-span-2">
                            <label class="text-xs text-slate-600 mb-1 block">üìü Device Name *</label>
                            <input type="text" id="deviceName" placeholder="Router-GW, SW-Core" 
                                class="w-full px-3 py-1.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-xs">
                        </div>
                        <div class="col-span-2">
                            <label class="text-xs text-slate-600 mb-1 block">üîß Brand/Model</label>
                            <input type="text" id="deviceBrandModel" placeholder="HPE Aruba 2930F" 
                                class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-xs">
                        </div>
                        <div class="col-span-1">
                            <label class="text-xs text-slate-600 mb-1 block">üè∑Ô∏è Type</label>
                            <select id="deviceType" class="w-full px-2 py-1.5 border border-slate-300 rounded-lg text-xs">
                                <option value="router">üì° Router</option>
                                <option value="switch">üîÄ Switch</option>
                                <option value="patch">üìå Patch Panel</option>
                                <option value="walljack">üîå Wall Jack</option>
                                <option value="firewall">üõ°Ô∏è Firewall</option>
                                <option value="server">üñ•Ô∏è Server</option>
                                <option value="wifi">üì∂ WiFi AP</option>
                                <option value="isp">üåê ISP/Provider</option>
                                <option value="router_wifi">üì∂ Router WiFi</option>
                                <option value="modem">üì† Modem</option>
                                <option value="hub">üîò Hub</option>
                                <option value="pc">üíª PC/Desktop</option>
                                <option value="tablet">üì± Tablet</option>
                                <option value="ip_phone">üìû IP Phone</option>
                                <option value="printer">üñ®Ô∏è Printer</option>
                                <option value="nas">üóÑÔ∏è NAS/Storage</option>
                                <option value="camera">üìπ IP Camera</option>
                                <option value="ups">üîã UPS</option>
                                <option value="others">üì¶ Others</option>
                            </select>
                        </div>
                        <div class="col-span-1">
                            <label class="text-xs text-slate-600 mb-1 block">‚ö° Status</label>
                            <select id="deviceStatus" class="w-full px-2 py-1.5 border border-slate-300 rounded-lg text-xs">
                                <option value="active">Active</option>
                                <option value="disabled">Disabled</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-2 mt-2">
                        <div>
                            <label class="text-xs text-slate-600 mb-1 block">‚öôÔ∏è Service</label>
                            <input type="text" id="deviceService" placeholder="DHCP, DNS, Gateway" 
                                class="w-full px-3 py-1.5 border border-slate-300 rounded-lg text-xs">
                        </div>
                        <div class="border border-green-200 rounded-lg p-2 bg-green-50">
                            <div class="flex items-center justify-between mb-1">
                                <h3 class="text-xs font-bold text-green-700">üåê IP Addresses</h3>
                                <button onclick="addIPField()" type="button"
                                    class="text-xs font-semibold text-green-600 hover:text-green-800 bg-green-100 hover:bg-green-200 px-2 py-0.5 rounded transition-colors">+ Add IP</button>
                            </div>
                            <div id="deviceIPContainer" class="space-y-1 max-h-32 overflow-y-auto">
                                <input type="text" class="ip-field w-full px-2 py-1 border border-green-300 rounded text-xs font-mono bg-white" placeholder="192.168.1.1/24 or VLAN 10">
                            </div>
                        </div>
                        <div class="border border-blue-200 rounded-lg p-2 bg-blue-50">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-xs font-bold text-blue-700">üîå Port Configuration</h3>
                                <button onclick="addPortTypeField()" type="button"
                                    class="text-xs font-semibold text-blue-600 hover:text-blue-800 bg-blue-100 hover:bg-blue-200 px-2 py-0.5 rounded transition-colors">+ Add Port Type</button>
                            </div>
                            <div id="portTypeQuantityContainer" class="space-y-1 max-h-48 overflow-y-auto"></div>
                        </div>
                        <div class="border border-purple-200 rounded-lg p-2 bg-purple-50">
                            <div class="flex items-center justify-between mb-1">
                                <h3 class="text-xs font-bold text-purple-700">üîó Links</h3>
                                <button onclick="addLinkField()" type="button"
                                    class="text-xs font-semibold text-purple-600 hover:text-purple-800 bg-purple-100 hover:bg-purple-200 px-2 py-0.5 rounded transition-colors">+ Add Link</button>
                            </div>
                            <div id="deviceLinksContainer" class="space-y-1 max-h-32 overflow-y-auto"></div>
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-2 mt-2 items-end">
                        <div class="flex-1 min-w-[200px]">
                            <label class="text-xs text-slate-600 mb-1 block">üìù Notes</label>
                            <input type="text" id="deviceNotes" placeholder="Notes (optional)"
                                class="w-full px-2 py-1.5 border border-slate-300 rounded-lg text-xs">
                        </div>
                        <button onclick="saveDevice()" 
                            class="bg-green-500 hover:bg-green-600 text-white font-semibold py-1.5 px-4 rounded-lg text-xs" id="saveDeviceButton">
                            + Add
                        </button>
                        <button onclick="cancelDeviceEdit()" id="cancelDeviceButton"
                            class="hidden bg-orange-400 hover:bg-orange-500 text-white font-semibold py-1.5 px-3 rounded-lg text-xs">
                            Cancel
                        </button>
                        <button onclick="clearDeviceForm()" 
                            class="bg-slate-400 hover:bg-slate-500 text-white font-semibold py-1.5 px-3 rounded-lg text-xs">
                            Clear
                        </button>
                    </div>
                </div>

                <!-- Devices List -->
                <div>
                    <div class="flex items-center gap-4 mb-3">
                        <h2 class="text-lg font-bold text-slate-800">Devices List</h2>
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-slate-500">View:</span>
                            <button onclick="setDeviceView('cards')" id="deviceViewCards" class="px-2 py-1 text-xs font-semibold rounded bg-slate-200 text-slate-700 hover:bg-slate-300">
                                üÉè Cards
                            </button>
                            <button onclick="setDeviceView('table')" id="deviceViewTable" class="px-2 py-1 text-xs font-semibold rounded bg-blue-500 text-white">
                                üìã Table
                            </button>
                        </div>
                    </div>
                    <!-- Filter Bar for Devices -->
                    <div id="deviceFilterBar">
                        <!-- Filters will be populated by JS -->
                    </div>
                    <div class="overflow-x-auto" id="devicesListContainer">
                        <div class="text-center text-slate-500 py-8">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Tab 2: Active Connections (with connection form) -->
            <div id="content-active" class="tab-content">
                <!-- Connection Form -->
                <div class="edit-mode-only bg-slate-50 rounded-lg p-3 mb-4" style="display:none;">
                    <h2 class="text-lg font-bold text-slate-800 mb-3" id="connectionFormTitle">Add Connection</h2>
                    <input type="hidden" id="connEditIndex" value="">
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 mb-3">
                        <!-- SOURCE Section -->
                        <div class="bg-orange-100 border border-orange-300 rounded-lg p-2">
                            <p class="text-xs font-bold text-orange-700 mb-2">üì§ SOURCE</p>
                            <div class="grid grid-cols-4 gap-2">
                                <div>
                                    <label class="text-xs text-slate-600 mb-1 block">üìç Location</label>
                                    <select id="fromLocation" onchange="updateFromGroups()" 
                                        class="w-full px-2 py-1.5 border border-orange-300 rounded-lg text-xs bg-white">
                                        <option value="">All</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-xs text-slate-600 mb-1 block">üóÇÔ∏è Group</label>
                                    <select id="fromGroup" onchange="updateFromDevices()" 
                                        class="w-full px-2 py-1.5 border border-orange-300 rounded-lg text-xs bg-white">
                                        <option value="">All</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-xs text-slate-600 mb-1 block">üìü Device *</label>
                                    <select id="fromDevice" onchange="updateFromPorts()" 
                                        class="w-full px-2 py-1.5 border-2 border-orange-400 rounded-lg text-xs bg-white font-medium">
                                        <option value="">Select...</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-xs text-slate-600 mb-1 block">üîå Port *</label>
                                    <select id="fromPort" class="w-full px-2 py-1.5 border-2 border-orange-400 rounded-lg text-xs bg-white font-medium">
                                        <option value="">Port</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- DESTINATION Section -->
                        <div class="bg-amber-50 border border-amber-300 rounded-lg p-2">
                            <p class="text-xs font-bold text-amber-700 mb-2">üì• DESTINATION</p>
                            <div class="grid grid-cols-4 gap-2">
                                <div>
                                    <label class="text-xs text-slate-600 mb-1 block">üìç Location</label>
                                    <select id="toLocation" onchange="updateToGroups()" 
                                        class="w-full px-2 py-1.5 border border-amber-300 rounded-lg text-xs bg-white">
                                        <option value="">All</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-xs text-slate-600 mb-1 block">üóÇÔ∏è Group</label>
                                    <select id="toGroup" onchange="updateToDevices()" 
                                        class="w-full px-2 py-1.5 border border-amber-300 rounded-lg text-xs bg-white">
                                        <option value="">All</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-xs text-slate-600 mb-1 block">üìü Device *</label>
                                    <select id="toDevice" onchange="updateToPorts(); toggleExternalDest()" 
                                        class="w-full px-2 py-1.5 border-2 border-amber-400 rounded-lg text-xs bg-white font-medium">
                                        <option value="">Select...</option>
                                    </select>
                                </div>
                                <div id="toPortContainer">
                                    <label class="text-xs text-slate-600 mb-1 block">üîå Port *</label>
                                    <select id="toPort" class="w-full px-2 py-1.5 border-2 border-amber-400 rounded-lg text-xs bg-white font-medium">
                                        <option value="">Port</option>
                                    </select>
                                </div>
                            </div>
                            <div class="hidden mt-2" id="externalDestContainer">
                                <label class="text-xs text-slate-600 mb-1 block">External Destination</label>
                                <input type="text" id="externalDest" placeholder="Fiber TIM, Internet WAN"
                                    class="w-full px-2 py-1.5 border border-amber-300 rounded-lg text-xs bg-white">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Connection Details + Notes + Buttons -->
                    <div class="flex flex-wrap gap-2 items-end">
                        <div class="w-32">
                            <label class="text-xs text-slate-600 mb-1 block">üè∑Ô∏è Type</label>
                            <select id="connType" class="w-full px-2 py-1.5 border border-slate-300 rounded-lg text-xs">
                                <option value="lan">‚ÜîÔ∏è LAN</option>
                                <option value="wan">üåê WAN/Internet</option>
                                <option value="dmz">üõ°Ô∏è DMZ</option>
                                <option value="trunk">‚¨ÜÔ∏è Trunk/Uplink</option>
                                <option value="management">‚öôÔ∏è Management</option>
                                <option value="backup">üíæ Backup</option>
                                <option value="fiber">üí° Fiber Optic</option>
                                <option value="wallport">üîå Wall Jack</option>
                                <option value="external">üì° External</option>
                                <option value="other">üì¶ Other</option>
                            </select>
                        </div>
                        <div class="w-24">
                            <label class="text-xs text-slate-600 mb-1 block">‚ö° Status</label>
                            <select id="connStatus" class="w-full px-2 py-1.5 border border-slate-300 rounded-lg text-xs">
                                <option value="active">Active</option>
                                <option value="disabled">Disabled</option>
                            </select>
                        </div>
                        <div class="w-20">
                            <label class="text-xs text-slate-600 mb-1 block">üîñ Cable ID</label>
                            <input type="text" id="cableMarker" maxlength="5" placeholder="1, A"
                                class="w-full px-2 py-1.5 border border-slate-300 rounded-lg text-xs text-center">
                        </div>
                        <div class="w-32">
                            <label class="text-xs text-slate-600 mb-1 block">üé® Color</label>
                            <div class="flex gap-1">
                                <select id="cableColor" onchange="syncCableColorInput()" class="flex-1 px-2 py-1.5 border border-slate-300 rounded-lg text-xs">
                                    <option value="">None</option>
                                    <option value="#000000" style="background:#000000;color:#fff;">Black</option>
                                    <option value="#ffffff" style="background:#ffffff;color:#000;border:1px solid #ccc;">White</option>
                                    <option value="#ef4444" style="background:#ef4444;color:#fff;">Red</option>
                                    <option value="#f97316" style="background:#f97316;color:#fff;">Orange</option>
                                    <option value="#eab308" style="background:#eab308;color:#000;">Yellow</option>
                                    <option value="#8b4513" style="background:#8b4513;color:#fff;">Brown</option>
                                    <option value="#22c55e" style="background:#22c55e;color:#fff;">Green</option>
                                    <option value="#3b82f6" style="background:#3b82f6;color:#fff;">Blue</option>
                                    <option value="#a855f7" style="background:#a855f7;color:#fff;">Purple</option>
                                    <option value="#ec4899" style="background:#ec4899;color:#fff;">Pink</option>
                                    <option value="#6b7280" style="background:#6b7280;color:#fff;">Gray</option>
                                    <option value="custom">Custom...</option>
                                </select>
                                <input type="color" id="cableColorPicker" onchange="syncCableColorFromPicker()" 
                                    class="w-8 h-8 p-0 border border-slate-300 rounded cursor-pointer" title="Custom color">
                            </div>
                        </div>
                        <div class="flex-1 min-w-[200px]">
                            <label class="text-xs text-slate-600 mb-1 block">üìù Notes</label>
                            <input type="text" id="connNotes" placeholder="Notes (optional)"
                                class="w-full px-2 py-1.5 border border-slate-300 rounded-lg text-xs">
                        </div>
                        <div class="flex gap-2">
                            <button onclick="saveConnection()" 
                                class="bg-green-500 hover:bg-green-600 text-white font-semibold py-1.5 px-4 rounded-lg text-xs whitespace-nowrap" id="saveConnectionButton">
                                + Add
                            </button>
                            <button onclick="cancelConnectionEdit()" id="cancelConnectionButton"
                                class="hidden bg-orange-400 hover:bg-orange-500 text-white font-semibold py-1.5 px-3 rounded-lg text-xs">
                                Cancel
                            </button>
                            <button onclick="clearConnectionForm()" 
                                class="bg-slate-400 hover:bg-slate-500 text-white font-semibold py-1.5 px-3 rounded-lg text-xs">
                                Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Connections List -->
                <div id="connectionsPrintArea">
                    <div class="flex flex-wrap items-center justify-between gap-3 mb-3">
                        <h2 class="text-lg font-bold text-slate-800">Active Connections</h2>
                        <button onclick="printConnections()" class="no-print bg-slate-500 hover:bg-slate-600 text-white font-semibold py-1 px-3 rounded-lg text-xs">
                            üñ®Ô∏è Print List
                        </button>
                    </div>
                    <!-- Filter Bar for Connections -->
                    <div id="connFilterBar">
                        <!-- Filters will be populated by JS -->
                    </div>
                    <div id="connectionsListContainer">
                        <div class="text-center text-slate-500 py-8">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: Matrix (Refactored - Topology Style) -->
            <div id="content-matrix" class="tab-content">
                <div id="matrixPrintArea">
                    <!-- Header with all controls in one line -->
                    <div class="flex items-center justify-between gap-4 mb-4 flex-wrap">
                        <!-- Left: Title + Stats -->
                        <div class="flex items-center gap-3">
                            <h2 class="text-xl font-bold text-slate-800">üìä Connection Matrix</h2>
                            <div id="matrixStats" class="no-print">
                                <!-- Stats populated by JS -->
                            </div>
                        </div>
                        
                        <!-- Right: Filters + Zoom + Actions -->
                        <div class="flex items-center gap-2 flex-wrap no-print">
                            <!-- Filters -->
                            <select id="matrixLocationFilter" onchange="filterMatrixByLocation()" class="px-2 py-1.5 border border-slate-300 rounded-lg text-sm">
                                <option value="">üìç All Locations</option>
                            </select>
                            <select id="matrixGroupFilter" onchange="filterMatrixByGroup()" class="px-2 py-1.5 border border-slate-300 rounded-lg text-sm">
                                <option value="">üóÑÔ∏è All Groups</option>
                            </select>
                            <label class="flex items-center gap-1.5 cursor-pointer bg-green-50 border border-green-300 rounded-lg px-2 py-1.5" title="Hide devices without connections">
                                <input type="checkbox" id="matrixOnlyConnected" onchange="toggleMatrixOnlyConnected()" checked class="w-3.5 h-3.5 accent-green-600">
                                <span class="text-xs text-green-700 font-medium">Connected</span>
                            </label>
                            
                            <!-- Zoom Controls -->
                            <div class="flex items-center gap-1 border-l border-slate-300 pl-2">
                                <button onclick="zoomMatrix(-1)" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-1 px-2 rounded text-sm" title="Zoom Out">‚àí</button>
                                <span id="matrixZoomLevel" class="text-xs text-slate-600 font-mono w-10 text-center">100%</span>
                                <button onclick="zoomMatrix(1)" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-1 px-2 rounded text-sm" title="Zoom In">+</button>
                                <button onclick="fitMatrixView()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-1 px-2.5 rounded text-sm" title="Fit to View">üìä Fit</button>
                            </div>
                            
                            <!-- Actions -->
                            <div class="flex items-center gap-1 border-l border-slate-300 pl-2">
                                <button onclick="exportMatrixPNG()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-1 px-2.5 rounded-lg text-sm" title="Export as PNG">üì∑ PNG</button>
                                <button onclick="printMatrix()" class="bg-slate-600 hover:bg-slate-700 text-white font-semibold py-1 px-2.5 rounded-lg text-sm" title="Print">üñ®Ô∏è Print</button>
                            </div>
                        </div>
                    </div>

                    <!-- Matrix Container - SVG based with native zoom/pan -->
                    <div class="overflow-hidden rounded-xl border border-slate-200 bg-gradient-to-br from-slate-50 to-slate-100 shadow-sm" 
                         id="matrixContainer" 
                         style="height: 600px; width: 100%; position: relative; cursor: grab;">
                        <div class="text-center text-slate-500 py-8">Loading...</div>
                    </div>

                    <!-- Tip - Compact version -->
                    <p class="mt-2 text-xs text-blue-600 no-print">üí° Scroll to zoom ‚Ä¢ Drag to pan ‚Ä¢ Click cell to edit ‚Ä¢ Headers stay fixed</p>

                    <!-- Tooltip container for hover details -->
                    <div id="matrixTooltip" class="fixed hidden z-50 bg-slate-800 text-white text-sm rounded-xl shadow-2xl p-4 pointer-events-none" style="min-width:420px;max-width:500px;">
                        <!-- Tooltip content populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Tab 4: Floor Plan -->
            <div id="content-floorplan" class="tab-content">
                <div class="flex items-center justify-between gap-4 mb-4 flex-wrap">
                    <!-- Left: Title + Stats -->
                    <div class="flex items-center gap-3">
                        <h2 class="text-xl font-bold text-slate-800">üè¢ Floor Plan</h2>
                        <div id="floorplanStats" class="flex items-center gap-2 text-xs">
                            <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded font-semibold">
                                üìç <span id="totalRoomsCount">0</span> Rooms
                            </span>
                        </div>
                    </div>
                    
                    <!-- Right: Filters + Zoom + Actions -->
                    <div class="flex items-center gap-2 flex-wrap">
                        <!-- Zoom Controls -->
                        <div class="flex items-center gap-1">
                            <button onclick="FloorPlan.zoom(-0.2)" class="bg-slate-500 hover:bg-slate-600 text-white font-bold py-1 px-2.5 rounded text-sm">‚àí</button>
                            <span id="floorplanZoomLevel" class="text-sm font-semibold text-slate-700 min-w-12 text-center">100%</span>
                            <button onclick="FloorPlan.zoom(0.2)" class="bg-slate-500 hover:bg-slate-600 text-white font-bold py-1 px-2.5 rounded text-sm">+</button>
                            <button onclick="FloorPlan.resetZoom()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-1 px-2.5 rounded text-sm ml-1">Reset</button>
                        </div>
                        
                        <!-- Room Management (Edit Mode Only) -->
                        <div class="edit-mode-only flex items-center gap-1 border-l border-slate-300 pl-2" style="display:none;">
                            <button onclick="FloorPlan.showAddRoomModal()" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-1 px-2.5 rounded-lg text-sm">+ Room</button>
                            <button onclick="FloorPlan.toggleEditMode()" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-1 px-2.5 rounded-lg text-sm" id="floorplanEditBtn">‚úèÔ∏è Edit</button>
                        </div>
                    </div>
                </div>

                <!-- Floor Plan Container Wrapper -->
                <div style="position: relative;">
                    <!-- Floor Plan Container -->
                    <div id="floorplanContainer" class="border border-slate-300 rounded-xl bg-gradient-to-br from-slate-50 to-slate-100" style="height: 600px; width: 100%; overflow: hidden; position: relative; cursor: grab;">
                        <div class="flex items-center justify-center h-full text-slate-400">
                            <p>Loading floor plan...</p>
                        </div>
                    </div>
                    <!-- Floating Room Legend (Vertical) -->
                    <div id="roomLegend" style="position: absolute; top: 12px; right: 12px; max-height: calc(100% - 24px); overflow-y: auto; background: rgba(255,255,255,0.92); backdrop-filter: blur(4px); border-radius: 10px; padding: 10px 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 100; min-width: 140px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px solid #e2e8f0; padding-bottom: 6px;">
                            <span style="font-size: 11px; font-weight: 700; color: #7c3aed;">üìç Rooms</span>
                            <button onclick="toggleRoomLegend()" id="roomLegendToggle" style="font-size: 9px; color: #7c3aed; background: none; border: none; cursor: pointer; opacity: 0.7;">‚ñº</button>
                        </div>
                        <div id="roomLegendContent" style="display: flex; flex-direction: column; gap: 3px;"></div>
                    </div>
                </div>

                <!-- Room Info Panel (Hidden by default) -->
                <div id="roomInfoPanel" class="mt-4 bg-white border border-slate-300 rounded-lg p-4" style="display:none;">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <h3 class="text-lg font-bold text-slate-800" id="roomInfoName">Room Name</h3>
                            <p class="text-sm text-slate-600" id="roomInfoType">Type</p>
                        </div>
                        <button onclick="FloorPlan.closeRoomPanel()" class="text-slate-400 hover:text-slate-600">‚úï</button>
                    </div>
                    <div id="roomInfoContent" class="text-sm text-slate-700">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Tips -->
                <p class="mt-2 text-xs text-blue-600">üí° Click on rooms to view details ‚Ä¢ Drag to pan ‚Ä¢ Scroll to zoom ‚Ä¢ Edit Mode: manage rooms and place devices</p>
            </div>

            <!-- Tab 5: Help -->
            <div id="content-help" class="tab-content">
                <div class="max-w-5xl mx-auto">
                    
                    <!-- ========== HEADER ========== -->
                    <div class="text-center mb-6">
                        <h1 class="text-3xl font-bold text-slate-800 mb-2">üìö Guida Utente Completa</h1>
                        <p class="text-slate-600">TIESSE Matrix Network Manager v3.4.0</p>
                        <p class="text-slate-500 text-sm mt-1">Documentazione completa per la gestione dell'infrastruttura di rete</p>
                    </div>

                    <!-- ========== INDICE NAVIGABILE ========== -->
                    <div class="bg-gradient-to-r from-slate-800 to-slate-700 text-white rounded-xl p-5 mb-6 shadow-lg" id="help-index">
                        <h2 class="text-lg font-bold mb-4 flex items-center gap-2">üìë Indice della Guida</h2>
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm">
                            <a href="#help-intro" class="block bg-white/10 hover:bg-white/20 rounded-lg p-3 transition-colors">
                                <span class="font-bold text-blue-300">0.</span> Introduzione e Concetti Base
                            </a>
                            <a href="#help-auth" class="block bg-white/10 hover:bg-white/20 rounded-lg p-3 transition-colors">
                                <span class="font-bold text-green-300">1.</span> Autenticazione e Permessi
                            </a>
                            <a href="#help-devices" class="block bg-white/10 hover:bg-white/20 rounded-lg p-3 transition-colors">
                                <span class="font-bold text-purple-300">2.</span> üì± Scheda Devices
                            </a>
                            <a href="#help-connections" class="block bg-white/10 hover:bg-white/20 rounded-lg p-3 transition-colors">
                                <span class="font-bold text-orange-300">3.</span> ‚ö° Scheda Connections
                            </a>
                            <a href="#help-topology" class="block bg-white/10 hover:bg-white/20 rounded-lg p-3 transition-colors">
                                <span class="font-bold text-cyan-300">4.</span> üó∫Ô∏è Scheda Topology
                            </a>
                            <a href="#help-matrix" class="block bg-white/10 hover:bg-white/20 rounded-lg p-3 transition-colors">
                                <span class="font-bold text-pink-300">5.</span> üìä Scheda Matrix
                            </a>
                            <a href="#help-floorplan" class="block bg-white/10 hover:bg-white/20 rounded-lg p-3 transition-colors">
                                <span class="font-bold text-emerald-300">6.</span> üè¢ Scheda Floor Plan
                            </a>
                            <a href="#help-logs" class="block bg-white/10 hover:bg-white/20 rounded-lg p-3 transition-colors">
                                <span class="font-bold text-amber-300">7.</span> üìã Scheda Logs
                            </a>
                            <a href="#help-export" class="block bg-white/10 hover:bg-white/20 rounded-lg p-3 transition-colors">
                                <span class="font-bold text-red-300">8.</span> üíæ Import/Export e Backup
                            </a>
                            <a href="#help-workflow" class="block bg-white/10 hover:bg-white/20 rounded-lg p-3 transition-colors">
                                <span class="font-bold text-yellow-300">9.</span> üîÑ Flusso di Lavoro
                            </a>
                            <a href="#help-glossary" class="block bg-white/10 hover:bg-white/20 rounded-lg p-3 transition-colors">
                                <span class="font-bold text-indigo-300">10.</span> üìñ Glossario Termini
                            </a>
                            <a href="#help-faq" class="block bg-white/10 hover:bg-white/20 rounded-lg p-3 transition-colors">
                                <span class="font-bold text-teal-300">11.</span> ‚ùì FAQ
                            </a>
                        </div>
                    </div>

                    <!-- ========== 0. INTRODUZIONE ========== -->
                    <div class="bg-blue-50 border-l-4 border-blue-500 rounded-r-xl p-5 mb-6" id="help-intro">
                        <h2 class="text-xl font-bold text-blue-800 mb-3 flex items-center gap-2">
                            <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">0</span>
                            Introduzione e Concetti Base
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="bg-white rounded-lg p-4 border border-blue-200">
                                <h3 class="font-bold text-blue-900 mb-2">üéØ Cos'√® TIESSE Matrix Network?</h3>
                                <p class="text-blue-800 text-sm">√à un sistema di <strong>documentazione visuale</strong> per infrastrutture di rete. Permette di:</p>
                                <ul class="text-blue-700 text-sm mt-2 ml-4 list-disc space-y-1">
                                    <li>Catalogare tutti i dispositivi di rete (router, switch, server, PC, ecc.)</li>
                                    <li>Documentare le connessioni fisiche tra dispositivi (cavi)</li>
                                    <li>Visualizzare la topologia di rete in modo grafico</li>
                                    <li>Organizzare i dispositivi per Location (sede) e Group (rack/stanza)</li>
                                    <li>Gestire le stanze nel Floor Plan con associazione dispositivi</li>
                                    <li>Esportare documentazione in Excel, JSON, PNG</li>
                                </ul>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-blue-200">
                                <h3 class="font-bold text-blue-900 mb-2">üèóÔ∏è Struttura Gerarchica dei Dati</h3>
                                <div class="bg-slate-50 rounded-lg p-3 font-mono text-xs text-slate-700">
<pre>üìç LOCATION (Sede/Reparto)
 ‚îî‚îÄ‚îÄ üóÇÔ∏è GROUP (Rack/Stanza/Zona)
      ‚îî‚îÄ‚îÄ üì± DEVICE (Dispositivo)
           ‚îú‚îÄ‚îÄ üîå PORTS (Porte fisiche)
           ‚îî‚îÄ‚îÄ ‚ö° CONNECTIONS (Connessioni)

üè¢ FLOOR PLAN
 ‚îî‚îÄ‚îÄ üö™ ROOM (Stanza)
      ‚îî‚îÄ‚îÄ üì± DEVICES (Dispositivi associati)</pre>
                                </div>
                                <p class="text-blue-600 text-xs mt-2">üí° Ogni dispositivo appartiene a una Location e un Group. Le stanze del Floor Plan possono avere dispositivi associati.</p>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-blue-200">
                                <h3 class="font-bold text-blue-900 mb-2">üñ•Ô∏è Panoramica dell'Interfaccia</h3>
                                <div class="grid md:grid-cols-2 gap-3 text-sm">
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <span class="font-bold text-slate-800">Header (Intestazione)</span>
                                        <p class="text-slate-600 text-xs mt-1">Logo, titolo, pulsanti Login/Logout, versione</p>
                                    </div>
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <span class="font-bold text-slate-800">Barra Azioni</span>
                                        <p class="text-slate-600 text-xs mt-1">Filtro Location, contatori, pulsanti Export/Import</p>
                                    </div>
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <span class="font-bold text-slate-800">Tab Navigation</span>
                                        <p class="text-slate-600 text-xs mt-1">Devices, Connections, Topology, Matrix, Floor Plan, Help</p>
                                    </div>
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <span class="font-bold text-slate-800">Area Contenuto</span>
                                        <p class="text-slate-600 text-xs mt-1">Contenuto della scheda attiva</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <a href="#help-index" class="text-blue-600 text-xs mt-3 inline-block hover:underline">‚Üë Torna all'indice</a>
                    </div>

                    <!-- ========== 1. AUTENTICAZIONE ========== -->
                    <div class="bg-green-50 border-l-4 border-green-500 rounded-r-xl p-5 mb-6" id="help-auth">
                        <h2 class="text-xl font-bold text-green-800 mb-3 flex items-center gap-2">
                            <span class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">1</span>
                            Autenticazione e Permessi
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="bg-white rounded-lg p-4 border border-green-200">
                                <h3 class="font-bold text-green-900 mb-2">üîê Due Modalit√† di Accesso</h3>
                                <div class="grid md:grid-cols-2 gap-3">
                                    <div class="bg-slate-50 p-3 rounded-lg border-l-4 border-slate-400">
                                        <span class="font-bold text-slate-800">üëÅÔ∏è View Mode (Ospite)</span>
                                        <p class="text-slate-600 text-xs mt-1">Accesso senza login. Puoi:</p>
                                        <ul class="text-slate-500 text-xs mt-1 ml-3 list-disc">
                                            <li>Visualizzare tutti i dati</li>
                                            <li>Navigare tra le schede</li>
                                            <li>Esportare Excel/JSON/PNG</li>
                                            <li>Stampare</li>
                                        </ul>
                                    </div>
                                    <div class="bg-green-100 p-3 rounded-lg border-l-4 border-green-500">
                                        <span class="font-bold text-green-800">‚úèÔ∏è Edit Mode (Autenticato)</span>
                                        <p class="text-green-700 text-xs mt-1">Dopo il login. Puoi anche:</p>
                                        <ul class="text-green-600 text-xs mt-1 ml-3 list-disc">
                                            <li>Aggiungere/Modificare/Eliminare dispositivi</li>
                                            <li>Creare/Modificare/Eliminare connessioni</li>
                                            <li>Gestire stanze nel Floor Plan</li>
                                            <li>Importare dati JSON</li>
                                            <li>Svuotare tutti i dati (Clear All)</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-green-200">
                                <h3 class="font-bold text-green-900 mb-2">üîì Come Effettuare il Login</h3>
                                <ol class="text-green-800 text-sm space-y-2 list-decimal ml-4">
                                    <li>Clicca il pulsante <span class="bg-blue-500 text-white px-2 py-0.5 rounded text-xs">üîì Edit Mode</span> in alto a destra</li>
                                    <li>Inserisci <strong>Username</strong> e <strong>Password</strong> forniti dall'amministratore</li>
                                    <li>Clicca <strong>Login</strong></li>
                                    <li>Vedrai il messaggio di benvenuto e i controlli di modifica diventeranno visibili</li>
                                </ol>
                                <div class="bg-amber-50 border border-amber-200 rounded-lg p-2 mt-3">
                                    <p class="text-amber-800 text-xs">‚ö†Ô∏è <strong>Importante:</strong> Dopo aver effettuato modifiche, clicca sempre <span class="bg-green-600 text-white px-2 py-0.5 rounded text-xs">üíæ Save Now</span> per salvare!</p>
                                </div>
                            </div>
                        </div>
                        <a href="#help-index" class="text-green-600 text-xs mt-3 inline-block hover:underline">‚Üë Torna all'indice</a>
                    </div>

                    <!-- ========== 2. SCHEDA DEVICES ========== -->
                    <div class="bg-purple-50 border-l-4 border-purple-500 rounded-r-xl p-5 mb-6" id="help-devices">
                        <h2 class="text-xl font-bold text-purple-800 mb-3 flex items-center gap-2">
                            <span class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">2</span>
                            üì± Scheda Devices (Dispositivi)
                        </h2>
                        
                        <div class="space-y-4">
                            <!-- Descrizione della scheda -->
                            <div class="bg-white rounded-lg p-4 border border-purple-200">
                                <h3 class="font-bold text-purple-900 mb-2">üìã Descrizione</h3>
                                <p class="text-purple-800 text-sm">La scheda <strong>Devices</strong> √® il cuore del sistema. Qui gestisci tutti i dispositivi della tua rete: router, switch, server, patch panel, access point, PC, stampanti, ecc.</p>
                            </div>

                            <!-- Form Add Device - Tutti i campi -->
                            <div class="bg-white rounded-lg p-4 border border-purple-200">
                                <h3 class="font-bold text-purple-900 mb-3">üìù Formulario "Add Device" - Tutti i Campi</h3>
                                
                                <div class="overflow-x-auto">
                                    <table class="w-full text-xs">
                                        <thead class="bg-purple-100">
                                            <tr>
                                                <th class="px-2 py-1 text-left font-bold text-purple-900">Campo</th>
                                                <th class="px-2 py-1 text-left font-bold text-purple-900">Obbl.</th>
                                                <th class="px-2 py-1 text-left font-bold text-purple-900">Descrizione</th>
                                                <th class="px-2 py-1 text-left font-bold text-purple-900">Esempio</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-purple-100">
                                            <tr class="bg-purple-50">
                                                <td class="px-2 py-2 font-semibold text-purple-800">üìç Location</td>
                                                <td class="px-2 py-2 text-red-600 font-bold">*</td>
                                                <td class="px-2 py-2 text-purple-700">Sede/reparto dove si trova il dispositivo</td>
                                                <td class="px-2 py-2"><code class="bg-purple-200 px-1 rounded">Sede Ivrea</code></td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 font-semibold text-purple-800">üóÇÔ∏è Group</td>
                                                <td class="px-2 py-2 text-red-600 font-bold">*</td>
                                                <td class="px-2 py-2 text-purple-700">Raggruppamento (rack, stanza, zona)</td>
                                                <td class="px-2 py-2"><code class="bg-purple-200 px-1 rounded">Rack-01</code>, <code class="bg-purple-200 px-1 rounded">Ufficio-12</code></td>
                                            </tr>
                                            <tr class="bg-purple-50">
                                                <td class="px-2 py-2 font-semibold text-purple-800">üî¢ Order</td>
                                                <td class="px-2 py-2 text-red-600 font-bold">*</td>
                                                <td class="px-2 py-2 text-purple-700">Posizione nel rack (01-99) o 00 per sparsi</td>
                                                <td class="px-2 py-2"><code class="bg-purple-200 px-1 rounded">01</code>, <code class="bg-purple-200 px-1 rounded">00</code></td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 font-semibold text-purple-800">‚Ü©Ô∏è Rear (R)</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-purple-700">Checkbox: dispositivo sul retro del rack</td>
                                                <td class="px-2 py-2">‚òëÔ∏è selezionato = retro</td>
                                            </tr>
                                            <tr class="bg-purple-50">
                                                <td class="px-2 py-2 font-semibold text-purple-800">üìü Device Name</td>
                                                <td class="px-2 py-2 text-red-600 font-bold">*</td>
                                                <td class="px-2 py-2 text-purple-700">Nome univoco del dispositivo</td>
                                                <td class="px-2 py-2"><code class="bg-purple-200 px-1 rounded">SW-Core-01</code></td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 font-semibold text-purple-800">üîß Brand/Model</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-purple-700">Marca e modello hardware</td>
                                                <td class="px-2 py-2"><code class="bg-purple-200 px-1 rounded">HPE Aruba 2930F</code></td>
                                            </tr>
                                            <tr class="bg-purple-50">
                                                <td class="px-2 py-2 font-semibold text-purple-800">üè∑Ô∏è Type</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-purple-700">Tipo dispositivo (icona nella topology)</td>
                                                <td class="px-2 py-2">Router, Switch, Server, Patch, WiFi...</td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 font-semibold text-purple-800">‚ö° Status</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-purple-700">Stato operativo</td>
                                                <td class="px-2 py-2"><span class="bg-green-100 text-green-800 px-1 rounded">Active</span> / <span class="bg-red-100 text-red-800 px-1 rounded">Disabled</span></td>
                                            </tr>
                                            <tr class="bg-purple-50">
                                                <td class="px-2 py-2 font-semibold text-purple-800">‚öôÔ∏è Service</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-purple-700">Servizi/ruoli del dispositivo</td>
                                                <td class="px-2 py-2"><code class="bg-purple-200 px-1 rounded">DHCP, DNS, Gateway</code></td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 font-semibold text-purple-800">üåê IP Addresses</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-purple-700">Fino a 4 indirizzi IP (formato CIDR)</td>
                                                <td class="px-2 py-2"><code class="bg-purple-200 px-1 rounded">192.168.1.1/24</code></td>
                                            </tr>
                                            <tr class="bg-purple-50">
                                                <td class="px-2 py-2 font-semibold text-purple-800">üîå Port Config</td>
                                                <td class="px-2 py-2 text-orange-600 font-bold">!</td>
                                                <td class="px-2 py-2 text-purple-700">Configurazione porte (tipo + quantit√†)</td>
                                                <td class="px-2 py-2">Eth √ó 24, SFP √ó 4</td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 font-semibold text-purple-800">üîó Links</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-purple-700">URL esterni (interfaccia web, docs)</td>
                                                <td class="px-2 py-2"><code class="bg-purple-200 px-1 rounded">https://192.168.1.1</code></td>
                                            </tr>
                                            <tr class="bg-purple-50">
                                                <td class="px-2 py-2 font-semibold text-purple-800">üìù Notes</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-purple-700">Note libere</td>
                                                <td class="px-2 py-2"><code class="bg-purple-200 px-1 rounded">Installato 15/01/2026</code></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <p class="text-purple-600 text-xs mt-2">* = Obbligatorio | ! = Importante per connessioni</p>
                            </div>

                            <!-- Tipi di dispositivo -->
                            <div class="bg-white rounded-lg p-4 border border-purple-200">
                                <h3 class="font-bold text-purple-900 mb-3">üè∑Ô∏è Tipi di Dispositivo Disponibili</h3>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs">
                                    <div class="bg-slate-50 p-2 rounded">üì° Router</div>
                                    <div class="bg-slate-50 p-2 rounded">üîÄ Switch</div>
                                    <div class="bg-slate-50 p-2 rounded">üìå Patch Panel</div>
                                    <div class="bg-slate-50 p-2 rounded">üîå Wall Jack</div>
                                    <div class="bg-slate-50 p-2 rounded">üõ°Ô∏è Firewall</div>
                                    <div class="bg-slate-50 p-2 rounded">üñ•Ô∏è Server</div>
                                    <div class="bg-slate-50 p-2 rounded">üì∂ WiFi AP</div>
                                    <div class="bg-slate-50 p-2 rounded">üåê ISP/Provider</div>
                                    <div class="bg-slate-50 p-2 rounded">üì∂ Router WiFi</div>
                                    <div class="bg-slate-50 p-2 rounded">üì† Modem</div>
                                    <div class="bg-slate-50 p-2 rounded">üîò Hub</div>
                                    <div class="bg-slate-50 p-2 rounded">üíª PC/Desktop</div>
                                    <div class="bg-slate-50 p-2 rounded">üì± Tablet</div>
                                    <div class="bg-slate-50 p-2 rounded">üìû IP Phone</div>
                                    <div class="bg-slate-50 p-2 rounded">üñ®Ô∏è Printer</div>
                                    <div class="bg-slate-50 p-2 rounded">üóÑÔ∏è NAS/Storage</div>
                                    <div class="bg-slate-50 p-2 rounded">üìπ IP Camera</div>
                                    <div class="bg-slate-50 p-2 rounded">üîã UPS</div>
                                    <div class="bg-slate-50 p-2 rounded">üì¶ Others</div>
                                </div>
                            </div>

                            <!-- Tipi di porta -->
                            <div class="bg-white rounded-lg p-4 border border-purple-200">
                                <h3 class="font-bold text-purple-900 mb-3">üîå Tipi di Porta Disponibili</h3>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs">
                                    <div class="bg-blue-50 p-2 rounded"><strong>Eth</strong> - Ethernet 10/100</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>GbE</strong> - Gigabit Ethernet</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>10GbE</strong> - 10 Gigabit</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>SFP</strong> - Small Form-factor</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>SFP+</strong> - Enhanced SFP</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>QSFP</strong> - Quad SFP</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>RJ45</strong> - Standard Ethernet</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>Console</strong> - Management</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>USB</strong> - USB port</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>Serial</strong> - RS-232</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>Fiber SC</strong> - SC connector</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>Fiber LC</strong> - LC connector</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>PoE</strong> - Power over Ethernet</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>PoE+</strong> - Enhanced PoE</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>WAN</strong> - WAN port</div>
                                    <div class="bg-blue-50 p-2 rounded"><strong>LAN</strong> - LAN port</div>
                                </div>
                            </div>

                            <!-- Visualizzazione lista -->
                            <div class="bg-white rounded-lg p-4 border border-purple-200">
                                <h3 class="font-bold text-purple-900 mb-2">üëÅÔ∏è Modalit√† di Visualizzazione</h3>
                                <div class="grid md:grid-cols-2 gap-3">
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <span class="font-bold text-slate-800">üÉè Cards View</span>
                                        <p class="text-slate-600 text-xs mt-1">Visualizzazione a schede, raggruppate per Location e Group. Ideale per panoramiche.</p>
                                    </div>
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <span class="font-bold text-slate-800">üìã Table View</span>
                                        <p class="text-slate-600 text-xs mt-1">Visualizzazione tabellare con tutti i dettagli. Ideale per ricerche e confronti.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Filtri -->
                            <div class="bg-white rounded-lg p-4 border border-purple-200">
                                <h3 class="font-bold text-purple-900 mb-2">üîç Filtri Disponibili</h3>
                                <div class="flex flex-wrap gap-2 text-xs">
                                    <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded">üìç Location</span>
                                    <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded">üóÇÔ∏è Group</span>
                                    <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded">üè∑Ô∏è Type</span>
                                    <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded">‚ö° Status</span>
                                    <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded">üîç Search (Nome/IP)</span>
                                </div>
                            </div>

                            <!-- Azioni sui dispositivi -->
                            <div class="bg-white rounded-lg p-4 border border-purple-200">
                                <h3 class="font-bold text-purple-900 mb-2">‚ö° Azioni sui Dispositivi</h3>
                                <div class="flex flex-wrap gap-2 text-xs">
                                    <span class="bg-green-500 text-white px-2 py-1 rounded">+ Add</span>
                                    <span class="bg-blue-500 text-white px-2 py-1 rounded">‚úèÔ∏è Edit</span>
                                    <span class="bg-red-500 text-white px-2 py-1 rounded">üóëÔ∏è Del</span>
                                    <span class="bg-purple-500 text-white px-2 py-1 rounded">üîó Links</span>
                                </div>
                                <p class="text-red-600 text-xs mt-2">‚ö†Ô∏è Eliminando un dispositivo, TUTTE le sue connessioni verranno eliminate!</p>
                            </div>
                        </div>
                        <a href="#help-index" class="text-purple-600 text-xs mt-3 inline-block hover:underline">‚Üë Torna all'indice</a>
                    </div>

                    <!-- ========== 3. SCHEDA CONNECTIONS ========== -->
                    <div class="bg-orange-50 border-l-4 border-orange-500 rounded-r-xl p-5 mb-6" id="help-connections">
                        <h2 class="text-xl font-bold text-orange-800 mb-3 flex items-center gap-2">
                            <span class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">3</span>
                            ‚ö° Scheda Active Connections
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="bg-white rounded-lg p-4 border border-orange-200">
                                <h3 class="font-bold text-orange-900 mb-2">üìã Descrizione</h3>
                                <p class="text-orange-800 text-sm">Qui crei e gestisci le <strong>connessioni fisiche</strong> (cavi) tra i dispositivi. Ogni connessione rappresenta un cavo che collega una porta di un dispositivo a una porta di un altro.</p>
                            </div>

                            <!-- Form Connection - Tutti i campi -->
                            <div class="bg-white rounded-lg p-4 border border-orange-200">
                                <h3 class="font-bold text-orange-900 mb-3">üìù Formulario "Add Connection" - Tutti i Campi</h3>
                                
                                <div class="overflow-x-auto">
                                    <table class="w-full text-xs">
                                        <thead class="bg-orange-100">
                                            <tr>
                                                <th class="px-2 py-1 text-left font-bold text-orange-900">Campo</th>
                                                <th class="px-2 py-1 text-left font-bold text-orange-900">Obbl.</th>
                                                <th class="px-2 py-1 text-left font-bold text-orange-900">Descrizione</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-orange-100">
                                            <tr class="bg-orange-50">
                                                <td class="px-2 py-2 font-semibold text-orange-800" colspan="3">üì§ SORGENTE (Da dove parte il cavo)</td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 text-orange-700">üìç From Location</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-orange-700">Filtra dispositivi per sede (opzionale)</td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 text-orange-700">üóÇÔ∏è From Group</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-orange-700">Filtra dispositivi per gruppo (opzionale)</td>
                                            </tr>
                                            <tr class="bg-orange-50">
                                                <td class="px-2 py-2 font-semibold text-orange-800">üìü From Device</td>
                                                <td class="px-2 py-2 text-red-600 font-bold">*</td>
                                                <td class="px-2 py-2 text-orange-700">Dispositivo da cui parte il cavo</td>
                                            </tr>
                                            <tr class="bg-orange-50">
                                                <td class="px-2 py-2 font-semibold text-orange-800">üîå From Port</td>
                                                <td class="px-2 py-2 text-red-600 font-bold">*</td>
                                                <td class="px-2 py-2 text-orange-700">Porta sorgente (solo disponibili)</td>
                                            </tr>
                                            <tr class="bg-amber-50">
                                                <td class="px-2 py-2 font-semibold text-amber-800" colspan="3">üì• DESTINAZIONE (Dove arriva il cavo)</td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 text-amber-700">üìç To Location</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-amber-700">Filtra dispositivi per sede (opzionale)</td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 text-amber-700">üóÇÔ∏è To Group</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-amber-700">Filtra dispositivi per gruppo (opzionale)</td>
                                            </tr>
                                            <tr class="bg-amber-50">
                                                <td class="px-2 py-2 font-semibold text-amber-800">üìü To Device</td>
                                                <td class="px-2 py-2 text-red-600 font-bold">*</td>
                                                <td class="px-2 py-2 text-amber-700">Dispositivo destinazione (o "External")</td>
                                            </tr>
                                            <tr class="bg-amber-50">
                                                <td class="px-2 py-2 font-semibold text-amber-800">üîå To Port</td>
                                                <td class="px-2 py-2 text-red-600 font-bold">*</td>
                                                <td class="px-2 py-2 text-amber-700">Porta destinazione (solo disponibili)</td>
                                            </tr>
                                            <tr class="bg-slate-50">
                                                <td class="px-2 py-2 font-semibold text-slate-800" colspan="3">üìã DETTAGLI CONNESSIONE</td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 text-slate-700">üè∑Ô∏è Type</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-slate-700">Tipo connessione (LAN, WAN, Trunk, ecc.)</td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 text-slate-700">‚ö° Status</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-slate-700">Active / Disabled</td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 text-slate-700">üîñ Cable ID</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-slate-700">Etichetta/numero del cavo fisico</td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 text-slate-700">üé® Color</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-slate-700">Colore del cavo (per identificazione)</td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 text-slate-700">üìù Notes</td>
                                                <td class="px-2 py-2 text-slate-400">-</td>
                                                <td class="px-2 py-2 text-slate-700">Note libere</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Tipi di connessione -->
                            <div class="bg-white rounded-lg p-4 border border-orange-200">
                                <h3 class="font-bold text-orange-900 mb-3">üè∑Ô∏è Tipi di Connessione e Colori</h3>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-xs">
                                    <div class="flex items-center gap-2 p-2 rounded bg-slate-50">
                                        <span class="w-4 h-4 rounded" style="background:#3b82f6"></span>
                                        <span><strong>LAN</strong> - Rete locale</span>
                                    </div>
                                    <div class="flex items-center gap-2 p-2 rounded bg-slate-50">
                                        <span class="w-4 h-4 rounded" style="background:#ef4444"></span>
                                        <span><strong>WAN</strong> - Internet/WAN</span>
                                    </div>
                                    <div class="flex items-center gap-2 p-2 rounded bg-slate-50">
                                        <span class="w-4 h-4 rounded" style="background:#f97316"></span>
                                        <span><strong>DMZ</strong> - Zona demilitarizzata</span>
                                    </div>
                                    <div class="flex items-center gap-2 p-2 rounded bg-slate-50">
                                        <span class="w-4 h-4 rounded" style="background:#22c55e"></span>
                                        <span><strong>Trunk</strong> - Uplink/Aggregazione</span>
                                    </div>
                                    <div class="flex items-center gap-2 p-2 rounded bg-slate-50">
                                        <span class="w-4 h-4 rounded" style="background:#8b5cf6"></span>
                                        <span><strong>Management</strong> - Gestione</span>
                                    </div>
                                    <div class="flex items-center gap-2 p-2 rounded bg-slate-50">
                                        <span class="w-4 h-4 rounded" style="background:#eab308"></span>
                                        <span><strong>Backup</strong> - Collegamento backup</span>
                                    </div>
                                    <div class="flex items-center gap-2 p-2 rounded bg-slate-50">
                                        <span class="w-4 h-4 rounded" style="background:#06b6d4"></span>
                                        <span><strong>Fiber</strong> - Fibra ottica</span>
                                    </div>
                                    <div class="flex items-center gap-2 p-2 rounded bg-slate-50">
                                        <span class="w-4 h-4 rounded" style="background:#a78bfa"></span>
                                        <span><strong>Wall Jack</strong> - Presa a muro</span>
                                    </div>
                                    <div class="flex items-center gap-2 p-2 rounded bg-slate-50">
                                        <span class="w-4 h-4 rounded" style="background:#ec4899"></span>
                                        <span><strong>External</strong> - Connessione esterna</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Patch Panel speciale -->
                            <div class="bg-purple-100 rounded-lg p-4 border border-purple-300">
                                <h3 class="font-bold text-purple-900 mb-2">üìå Funzionalit√† Speciale: Patch Panel</h3>
                                <p class="text-purple-800 text-sm mb-2">I <strong>Patch Panel</strong> hanno una logica speciale: ogni porta pu√≤ avere <strong>2 connessioni</strong> (fronte e retro).</p>
                                <div class="bg-white p-3 rounded-lg text-xs">
                                    <p class="font-semibold text-purple-900 mb-1">Esempio:</p>
                                    <ol class="text-purple-700 list-decimal ml-4 space-y-1">
                                        <li>Wall Jack (parete) ‚Üí Patch Panel porta 19 (RETRO)</li>
                                        <li>Patch Panel porta 19 ‚Üí Switch porta 33 (FRONTE)</li>
                                    </ol>
                                    <p class="text-purple-600 mt-2">Indicatori: <code class="bg-purple-200 px-1 rounded">(Libera)</code>, <code class="bg-purple-200 px-1 rounded">(1/2)</code>, <code class="bg-purple-200 px-1 rounded">(2/2 - completa)</code></p>
                                </div>
                            </div>
                        </div>
                        <a href="#help-index" class="text-orange-600 text-xs mt-3 inline-block hover:underline">‚Üë Torna all'indice</a>
                    </div>

                    <!-- ========== 4. SCHEDA TOPOLOGY ========== -->
                    <div class="bg-cyan-50 border-l-4 border-cyan-500 rounded-r-xl p-5 mb-6" id="help-topology">
                        <h2 class="text-xl font-bold text-cyan-800 mb-3 flex items-center gap-2">
                            <span class="bg-cyan-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">4</span>
                            üó∫Ô∏è Scheda Topology (Mappa di Rete)
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="bg-white rounded-lg p-4 border border-cyan-200">
                                <h3 class="font-bold text-cyan-900 mb-2">üìã Descrizione</h3>
                                <p class="text-cyan-800 text-sm">Visualizzazione grafica interattiva della rete con <strong>icone stile Cisco</strong>. Mostra dispositivi come nodi e connessioni come linee colorate.</p>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-cyan-200">
                                <h3 class="font-bold text-cyan-900 mb-2">üéõÔ∏è Controlli Disponibili</h3>
                                <div class="grid md:grid-cols-2 gap-3 text-xs">
                                    <div class="bg-slate-50 p-2 rounded">
                                        <strong>üìç Filtro Location:</strong> Mostra solo una sede
                                    </div>
                                    <div class="bg-slate-50 p-2 rounded">
                                        <strong>üóÇÔ∏è Filtro Group:</strong> Mostra solo un gruppo
                                    </div>
                                    <div class="bg-slate-50 p-2 rounded">
                                        <strong>üîÑ Layout:</strong> Auto, Circle, Grid, Hierarchical
                                    </div>
                                    <div class="bg-slate-50 p-2 rounded">
                                        <strong>üó∫Ô∏è Fit View:</strong> Centra e adatta la vista
                                    </div>
                                    <div class="bg-slate-50 p-2 rounded">
                                        <strong>üìã Legend:</strong> Mostra legenda dispositivi
                                    </div>
                                    <div class="bg-slate-50 p-2 rounded">
                                        <strong>üì∑ Export PNG:</strong> Scarica immagine
                                    </div>
                                    <div class="bg-slate-50 p-2 rounded">
                                        <strong>üì• Export .drawio:</strong> Esporta per Draw.io
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-cyan-200">
                                <h3 class="font-bold text-cyan-900 mb-2">üñ±Ô∏è Interazioni Mouse</h3>
                                <div class="grid md:grid-cols-2 gap-2 text-xs">
                                    <div class="bg-cyan-100 p-2 rounded">üñ±Ô∏è <strong>Drag dispositivo:</strong> Riposiziona</div>
                                    <div class="bg-cyan-100 p-2 rounded">üñ±Ô∏è <strong>Drag sfondo:</strong> Pan (sposta vista)</div>
                                    <div class="bg-cyan-100 p-2 rounded">‚öôÔ∏è <strong>Scroll:</strong> Zoom in/out</div>
                                    <div class="bg-cyan-100 p-2 rounded">üëÜ <strong>Hover:</strong> Mostra dettagli</div>
                                </div>
                            </div>
                        </div>
                        <a href="#help-index" class="text-cyan-600 text-xs mt-3 inline-block hover:underline">‚Üë Torna all'indice</a>
                    </div>

                    <!-- ========== 5. SCHEDA MATRIX ========== -->
                    <div class="bg-pink-50 border-l-4 border-pink-500 rounded-r-xl p-5 mb-6" id="help-matrix">
                        <h2 class="text-xl font-bold text-pink-800 mb-3 flex items-center gap-2">
                            <span class="bg-pink-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">5</span>
                            üìä Scheda Matrix (Matrice Connessioni)
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="bg-white rounded-lg p-4 border border-pink-200">
                                <h3 class="font-bold text-pink-900 mb-2">üìã Descrizione</h3>
                                <p class="text-pink-800 text-sm">Una <strong>griglia visuale</strong> che mostra tutte le connessioni in formato tabellare. Righe = dispositivi sorgente, Colonne = dispositivi destinazione.</p>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-pink-200">
                                <h3 class="font-bold text-pink-900 mb-2">üìñ Come Leggere la Matrice</h3>
                                <div class="bg-slate-50 p-3 rounded-lg text-xs font-mono">
<pre>          ‚îÇ Device-A ‚îÇ Device-B ‚îÇ Device-C ‚îÇ
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
Device-A  ‚îÇ    -     ‚îÇ   üîµ     ‚îÇ          ‚îÇ
Device-B  ‚îÇ   üîµ     ‚îÇ    -     ‚îÇ   üü¢     ‚îÇ
Device-C  ‚îÇ          ‚îÇ   üü¢     ‚îÇ    -     ‚îÇ</pre>
                                </div>
                                <ul class="text-pink-700 text-xs mt-2 space-y-1">
                                    <li>üîµ = Connessione LAN tra Device-A e Device-B</li>
                                    <li>üü¢ = Connessione Trunk tra Device-B e Device-C</li>
                                    <li>Vuoto = Nessuna connessione</li>
                                </ul>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-pink-200">
                                <h3 class="font-bold text-pink-900 mb-2">üéõÔ∏è Controlli</h3>
                                <div class="flex flex-wrap gap-2 text-xs">
                                    <span class="bg-pink-100 text-pink-800 px-2 py-1 rounded">üìç Filtro Location</span>
                                    <span class="bg-pink-100 text-pink-800 px-2 py-1 rounded">üóÇÔ∏è Filtro Group</span>
                                    <span class="bg-pink-100 text-pink-800 px-2 py-1 rounded">‚òëÔ∏è Solo connessi</span>
                                    <span class="bg-pink-100 text-pink-800 px-2 py-1 rounded">‚ûï/‚ûñ Zoom</span>
                                    <span class="bg-pink-100 text-pink-800 px-2 py-1 rounded">üìä Fit View</span>
                                    <span class="bg-pink-100 text-pink-800 px-2 py-1 rounded">üì∑ Export PNG</span>
                                    <span class="bg-pink-100 text-pink-800 px-2 py-1 rounded">üñ®Ô∏è Print</span>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-pink-200">
                                <h3 class="font-bold text-pink-900 mb-2">üëÜ Interazioni</h3>
                                <ul class="text-pink-700 text-xs space-y-1">
                                    <li><strong>Click su cella:</strong> Modifica quella connessione</li>
                                    <li><strong>Hover su cella:</strong> Mostra dettagli (porte, tipo, cavo)</li>
                                    <li><strong>Scroll:</strong> Zoom in/out</li>
                                    <li><strong>Drag:</strong> Pan (sposta vista)</li>
                                </ul>
                            </div>
                        </div>
                        <a href="#help-index" class="text-pink-600 text-xs mt-3 inline-block hover:underline">‚Üë Torna all'indice</a>
                    </div>

                    <!-- ========== 6. SCHEDA FLOOR PLAN ========== -->
                    <div class="bg-emerald-50 border-l-4 border-emerald-500 rounded-r-xl p-5 mb-6" id="help-floorplan">
                        <h2 class="text-xl font-bold text-emerald-800 mb-3 flex items-center gap-2">
                            <span class="bg-emerald-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">6</span>
                            üè¢ Scheda Floor Plan (Planimetria)
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="bg-white rounded-lg p-4 border border-emerald-200">
                                <h3 class="font-bold text-emerald-900 mb-2">üìã Descrizione</h3>
                                <p class="text-emerald-800 text-sm">Visualizzazione delle <strong>stanze fisiche</strong> della sede con i dispositivi associati. Permette di vedere dove sono posizionati fisicamente i dispositivi.</p>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-emerald-200">
                                <h3 class="font-bold text-emerald-900 mb-3">üìù Struttura delle Stanze</h3>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-xs">
                                        <thead class="bg-emerald-100">
                                            <tr>
                                                <th class="px-2 py-1 text-left font-bold text-emerald-900">Campo</th>
                                                <th class="px-2 py-1 text-left font-bold text-emerald-900">Descrizione</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-emerald-100">
                                            <tr>
                                                <td class="px-2 py-2 font-semibold text-emerald-800">üÜî ID</td>
                                                <td class="px-2 py-2 text-emerald-700">Identificativo numerico automatico (1, 2, 3...)</td>
                                            </tr>
                                            <tr class="bg-emerald-50">
                                                <td class="px-2 py-2 font-semibold text-emerald-800">üè∑Ô∏è Nickname</td>
                                                <td class="px-2 py-2 text-emerald-700">Nome descrittivo (es. "Sala Server", "Ufficio 12"). <strong class="text-red-600">Usato per associare dispositivi!</strong></td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 font-semibold text-emerald-800">üî∑ Polygon</td>
                                                <td class="px-2 py-2 text-emerald-700">Forma della stanza (poligono con coordinate X/Y)</td>
                                            </tr>
                                            <tr class="bg-emerald-50">
                                                <td class="px-2 py-2 font-semibold text-emerald-800">üé® Color</td>
                                                <td class="px-2 py-2 text-emerald-700">Colore di riempimento (RGBA per trasparenza)</td>
                                            </tr>
                                            <tr>
                                                <td class="px-2 py-2 font-semibold text-emerald-800">üìê Area</td>
                                                <td class="px-2 py-2 text-emerald-700">Area calcolata automaticamente dal poligono</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="bg-amber-100 rounded-lg p-4 border border-amber-300">
                                <h3 class="font-bold text-amber-900 mb-2">üîó Come Associare Dispositivi a una Stanza</h3>
                                <p class="text-amber-800 text-sm mb-2">L'associazione <strong>NON</strong> √® diretta dalla stanza. Invece:</p>
                                <ol class="text-amber-700 text-xs list-decimal ml-4 space-y-1">
                                    <li>Vai nella stanza e imposta un <strong>Nickname</strong> (es. "Sala Server")</li>
                                    <li>Vai alla scheda <strong>Devices</strong></li>
                                    <li>Modifica il dispositivo e imposta <strong>Location</strong> = "Sala Server" (stesso nickname)</li>
                                    <li>Il dispositivo apparir√† automaticamente nella stanza!</li>
                                </ol>
                                <p class="text-amber-600 text-xs mt-2">üí° La Location del dispositivo deve corrispondere esattamente al Nickname della stanza.</p>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-emerald-200">
                                <h3 class="font-bold text-emerald-900 mb-2">üéõÔ∏è Controlli</h3>
                                <div class="flex flex-wrap gap-2 text-xs">
                                    <span class="bg-emerald-100 text-emerald-800 px-2 py-1 rounded">‚ûï/‚ûñ Zoom</span>
                                    <span class="bg-emerald-100 text-emerald-800 px-2 py-1 rounded">üîÑ Reset</span>
                                </div>
                                <p class="text-emerald-600 text-xs mt-2">üí° Le stanze sono mappate tramite uno strumento separato (draw-rooms-v2.html)</p>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-emerald-200">
                                <h3 class="font-bold text-emerald-900 mb-2">üñ±Ô∏è Interazioni</h3>
                                <ul class="text-emerald-700 text-xs space-y-1">
                                    <li><strong>Click su stanza:</strong> Mostra dettagli e dispositivi associati</li>
                                    <li><strong>Hover su stanza:</strong> Evidenzia la stanza</li>
                                    <li><strong>Scroll:</strong> Zoom in/out</li>
                                    <li><strong>Drag sfondo:</strong> Pan (sposta vista)</li>
                                </ul>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-emerald-200">
                                <h3 class="font-bold text-emerald-900 mb-2">üìç Legenda Stanze</h3>
                                <p class="text-emerald-700 text-xs">In alto a destra appare la legenda con ID e Nickname di ogni stanza. Stanze con dispositivi mostrano un badge numerico.</p>
                            </div>
                        </div>
                        <a href="#help-index" class="text-emerald-600 text-xs mt-3 inline-block hover:underline">‚Üë Torna all'indice</a>
                    </div>

                    <!-- ========== 7. SCHEDA LOGS ========== -->
                    <div class="bg-amber-50 border-l-4 border-amber-500 rounded-r-xl p-5 mb-6" id="help-logs">
                        <h2 class="text-xl font-bold text-amber-800 mb-3 flex items-center gap-2">
                            <span class="bg-amber-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">7</span>
                            üìã Scheda Activity Logs
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="bg-white rounded-lg p-4 border border-amber-200">
                                <h3 class="font-bold text-amber-900 mb-2">üìã Descrizione</h3>
                                <p class="text-amber-800 text-sm">Registro delle <strong>ultime 200 modifiche</strong> effettuate al sistema. Utile per tracciare chi ha fatto cosa e quando.</p>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-amber-200">
                                <h3 class="font-bold text-amber-900 mb-2">üìä Informazioni per ogni Log</h3>
                                <div class="grid grid-cols-2 md:grid-cols-5 gap-2 text-xs">
                                    <div class="bg-amber-100 p-2 rounded text-center">üìÖ Timestamp</div>
                                    <div class="bg-amber-100 p-2 rounded text-center">üè∑Ô∏è Action</div>
                                    <div class="bg-amber-100 p-2 rounded text-center">üì¶ Type</div>
                                    <div class="bg-amber-100 p-2 rounded text-center">üìù Details</div>
                                    <div class="bg-amber-100 p-2 rounded text-center">üë§ User</div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-amber-200">
                                <h3 class="font-bold text-amber-900 mb-2">üîç Filtri Disponibili</h3>
                                <div class="flex flex-wrap gap-2 text-xs">
                                    <span class="bg-slate-200 text-slate-800 px-2 py-1 rounded">All Activities</span>
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded">Devices</span>
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded">Connections</span>
                                    <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded">Import/Export</span>
                                    <span class="bg-amber-100 text-amber-800 px-2 py-1 rounded">Authentication</span>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-amber-200">
                                <h3 class="font-bold text-amber-900 mb-2">‚ö° Azioni</h3>
                                <div class="flex flex-wrap gap-2 text-xs">
                                    <span class="bg-red-500 text-white px-2 py-1 rounded">üóëÔ∏è Clear Logs</span>
                                    <span class="bg-slate-500 text-white px-2 py-1 rounded">üì• Export Logs</span>
                                </div>
                            </div>
                        </div>
                        <a href="#help-index" class="text-amber-600 text-xs mt-3 inline-block hover:underline">‚Üë Torna all'indice</a>
                    </div>

                    <!-- ========== 8. IMPORT/EXPORT ========== -->
                    <div class="bg-red-50 border-l-4 border-red-500 rounded-r-xl p-5 mb-6" id="help-export">
                        <h2 class="text-xl font-bold text-red-800 mb-3 flex items-center gap-2">
                            <span class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">8</span>
                            üíæ Import/Export e Backup
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="bg-white rounded-lg p-4 border border-red-200">
                                <h3 class="font-bold text-red-900 mb-3">üì§ Funzioni di Esportazione</h3>
                                <div class="space-y-3">
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="bg-indigo-500 text-white px-2 py-0.5 rounded text-xs">üìä Export Excel</span>
                                            <span class="text-slate-500 text-xs">Pubblico</span>
                                        </div>
                                        <p class="text-slate-700 text-xs">Crea file .xlsx con 4 fogli: Devices, Connections, Matrix, Rooms</p>
                                    </div>
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="bg-slate-500 text-white px-2 py-0.5 rounded text-xs">üíæ Export JSON</span>
                                            <span class="text-slate-500 text-xs">Pubblico</span>
                                        </div>
                                        <p class="text-slate-700 text-xs">Backup completo: devices, connections, rooms, version. Usalo per ripristini!</p>
                                    </div>
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="bg-indigo-500 text-white px-2 py-0.5 rounded text-xs">üì∑ Export PNG</span>
                                            <span class="text-slate-500 text-xs">Topology/Matrix</span>
                                        </div>
                                        <p class="text-slate-700 text-xs">Immagine della topologia o matrice con titolo e data</p>
                                    </div>
                                    <div class="bg-slate-50 p-3 rounded-lg">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="bg-orange-500 text-white px-2 py-0.5 rounded text-xs">üì• Export .drawio</span>
                                            <span class="text-slate-500 text-xs">Topology</span>
                                        </div>
                                        <p class="text-slate-700 text-xs">File modificabile in Draw.io/diagrams.net</p>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-red-200">
                                <h3 class="font-bold text-red-900 mb-3">üì• Funzioni di Importazione</h3>
                                <div class="bg-slate-50 p-3 rounded-lg">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="bg-slate-500 text-white px-2 py-0.5 rounded text-xs">üì• Import JSON</span>
                                        <span class="text-red-500 text-xs font-bold">üîí Richiede Login</span>
                                    </div>
                                    <p class="text-slate-700 text-xs">Importa un file JSON precedentemente esportato. <strong class="text-red-600">ATTENZIONE:</strong> Sovrascrive TUTTI i dati esistenti!</p>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-red-200">
                                <h3 class="font-bold text-red-900 mb-2">‚ö†Ô∏è Clear All (Svuota Tutto)</h3>
                                <p class="text-red-700 text-xs">Elimina TUTTI i dati (devices, connections, rooms). Prima dell'eliminazione viene creato automaticamente un backup JSON scaricabile.</p>
                                <p class="text-red-600 text-xs mt-1 font-bold">üîí Richiede Login</p>
                            </div>

                            <div class="bg-amber-100 rounded-lg p-4 border border-amber-300">
                                <h3 class="font-bold text-amber-900 mb-2">üí° Best Practice per i Backup</h3>
                                <ol class="text-amber-800 text-xs list-decimal ml-4 space-y-1">
                                    <li>Esporta JSON <strong>regolarmente</strong> (almeno settimanalmente)</li>
                                    <li>Conserva i backup in una <strong>cartella sicura</strong></li>
                                    <li>Usa nomi descrittivi: <code class="bg-amber-200 px-1 rounded">network_2026-02-01.json</code></li>
                                    <li>Prima di modifiche importanti, fai <strong>sempre</strong> un backup</li>
                                </ol>
                            </div>
                        </div>
                        <a href="#help-index" class="text-red-600 text-xs mt-3 inline-block hover:underline">‚Üë Torna all'indice</a>
                    </div>

                    <!-- ========== 9. FLUSSO DI LAVORO ========== -->
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 rounded-r-xl p-5 mb-6" id="help-workflow">
                        <h2 class="text-xl font-bold text-yellow-800 mb-3 flex items-center gap-2">
                            <span class="bg-yellow-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">9</span>
                            üîÑ Flusso di Lavoro Consigliato
                        </h2>
                        
                        <div class="space-y-4">
                            <div class="bg-white rounded-lg p-4 border border-yellow-200">
                                <h3 class="font-bold text-yellow-900 mb-3">üìã Workflow per Nuova Installazione</h3>
                                <div class="bg-slate-50 p-4 rounded-lg font-mono text-xs">
<pre class="text-slate-700">
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1Ô∏è‚É£  LOGIN                                                   ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ Clicca "Edit Mode" ‚Üí Inserisci credenziali         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  2Ô∏è‚É£  CREA DISPOSITIVI (Scheda Devices)                      ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ Definisci Location (sede)                          ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ Definisci Group (rack/stanza)                      ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ Aggiungi tutti i dispositivi                       ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ ‚ö†Ô∏è Configura le PORTE per ogni dispositivo!        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  3Ô∏è‚É£  CREA CONNESSIONI (Scheda Connections)                  ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ Seleziona dispositivo sorgente + porta             ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ Seleziona dispositivo destinazione + porta         ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ Aggiungi tipo, colore cavo, ID                     ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ Ripeti per ogni cavo fisico                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  4Ô∏è‚É£  CONFIGURA FLOOR PLAN (Scheda Floor Plan)               ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ Crea le stanze                                     ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ Posiziona e dimensiona                             ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ Associa dispositivi alle stanze                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  5Ô∏è‚É£  VERIFICA (Schede Topology e Matrix)                    ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ Controlla la topologia visuale                     ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ Verifica la matrice delle connessioni              ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ Correggi eventuali errori                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  6Ô∏è‚É£  SALVA E BACKUP                                         ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ üíæ Clicca "Save Now"                               ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ üìä Esporta Excel per documentazione                ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ üíæ Esporta JSON per backup                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</pre>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg p-4 border border-yellow-200">
                                <h3 class="font-bold text-yellow-900 mb-2">‚ö° Workflow per Modifiche Rapide</h3>
                                <ol class="text-yellow-800 text-xs list-decimal ml-4 space-y-1">
                                    <li>Login (se necessario)</li>
                                    <li>Vai alla scheda appropriata (Devices o Connections)</li>
                                    <li>Trova l'elemento da modificare</li>
                                    <li>Clicca "Edit" ‚Üí Modifica ‚Üí "Update"</li>
                                    <li><strong>üíæ Save Now</strong></li>
                                </ol>
                            </div>
                        </div>
                        <a href="#help-index" class="text-yellow-600 text-xs mt-3 inline-block hover:underline">‚Üë Torna all'indice</a>
                    </div>

                    <!-- ========== 10. GLOSSARIO ========== -->
                    <div class="bg-indigo-50 border-l-4 border-indigo-500 rounded-r-xl p-5 mb-6" id="help-glossary">
                        <h2 class="text-xl font-bold text-indigo-800 mb-3 flex items-center gap-2">
                            <span class="bg-indigo-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">10</span>
                            üìñ Glossario dei Termini
                        </h2>
                        
                        <div class="bg-white rounded-lg p-4 border border-indigo-200">
                            <div class="grid md:grid-cols-2 gap-3 text-xs">
                                <div class="bg-slate-50 p-2 rounded">
                                    <strong class="text-indigo-900">Location</strong>
                                    <p class="text-slate-600">Sede fisica o reparto (es. "Sede Ivrea", "Ufficio Milano")</p>
                                </div>
                                <div class="bg-slate-50 p-2 rounded">
                                    <strong class="text-indigo-900">Group</strong>
                                    <p class="text-slate-600">Raggruppamento logico (rack, armadio, stanza, zona)</p>
                                </div>
                                <div class="bg-slate-50 p-2 rounded">
                                    <strong class="text-indigo-900">Order</strong>
                                    <p class="text-slate-600">Posizione fisica nel rack (01-99) o 00 per sparsi</p>
                                </div>
                                <div class="bg-slate-50 p-2 rounded">
                                    <strong class="text-indigo-900">Rear (R)</strong>
                                    <p class="text-slate-600">Indica dispositivo montato sul retro del rack</p>
                                </div>
                                <div class="bg-slate-50 p-2 rounded">
                                    <strong class="text-indigo-900">Patch Panel</strong>
                                    <p class="text-slate-600">Pannello con porte passanti (fronte ‚Üî retro)</p>
                                </div>
                                <div class="bg-slate-50 p-2 rounded">
                                    <strong class="text-indigo-900">Wall Jack</strong>
                                    <p class="text-slate-600">Presa di rete a muro</p>
                                </div>
                                <div class="bg-slate-50 p-2 rounded">
                                    <strong class="text-indigo-900">Trunk/Uplink</strong>
                                    <p class="text-slate-600">Connessione principale tra switch</p>
                                </div>
                                <div class="bg-slate-50 p-2 rounded">
                                    <strong class="text-indigo-900">CIDR</strong>
                                    <p class="text-slate-600">Notazione IP con maschera (es. 192.168.1.1/24)</p>
                                </div>
                                <div class="bg-slate-50 p-2 rounded">
                                    <strong class="text-indigo-900">SFP/SFP+</strong>
                                    <p class="text-slate-600">Porta per moduli ottici intercambiabili</p>
                                </div>
                                <div class="bg-slate-50 p-2 rounded">
                                    <strong class="text-indigo-900">PoE</strong>
                                    <p class="text-slate-600">Power over Ethernet - alimentazione via cavo rete</p>
                                </div>
                                <div class="bg-slate-50 p-2 rounded">
                                    <strong class="text-indigo-900">DMZ</strong>
                                    <p class="text-slate-600">Demilitarized Zone - rete semi-pubblica</p>
                                </div>
                                <div class="bg-slate-50 p-2 rounded">
                                    <strong class="text-indigo-900">Topology</strong>
                                    <p class="text-slate-600">Rappresentazione grafica della struttura di rete</p>
                                </div>
                            </div>
                        </div>
                        <a href="#help-index" class="text-indigo-600 text-xs mt-3 inline-block hover:underline">‚Üë Torna all'indice</a>
                    </div>

                    <!-- ========== 11. FAQ ========== -->
                    <div class="bg-teal-50 border-l-4 border-teal-500 rounded-r-xl p-5 mb-6" id="help-faq">
                        <h2 class="text-xl font-bold text-teal-800 mb-3 flex items-center gap-2">
                            <span class="bg-teal-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">11</span>
                            ‚ùì Domande Frequenti (FAQ)
                        </h2>
                        
                        <div class="space-y-3">
                            <details class="bg-white rounded-lg border border-teal-200">
                                <summary class="font-semibold text-teal-900 p-3 cursor-pointer hover:bg-teal-50">Come faccio il login?</summary>
                                <p class="text-teal-700 text-sm p-3 pt-0">Clicca <span class="bg-blue-500 text-white px-2 py-0.5 rounded text-xs">üîì Edit Mode</span> in alto a destra, inserisci username e password forniti dall'amministratore.</p>
                            </details>

                            <details class="bg-white rounded-lg border border-teal-200">
                                <summary class="font-semibold text-teal-900 p-3 cursor-pointer hover:bg-teal-50">Cosa significa Order = 00?</summary>
                                <p class="text-teal-700 text-sm p-3 pt-0">Order 00 indica un dispositivo "sparso" non montato in un rack (es. access point sul soffitto, router in altra stanza).</p>
                            </details>

                            <details class="bg-white rounded-lg border border-teal-200">
                                <summary class="font-semibold text-teal-900 p-3 cursor-pointer hover:bg-teal-50">Quando uso il checkbox "Rear"?</summary>
                                <p class="text-teal-700 text-sm p-3 pt-0">Quando il dispositivo √® montato nella parte posteriore del rack. Convenzione: fronte 01-50, retro 99-50.</p>
                            </details>

                            <details class="bg-white rounded-lg border border-teal-200">
                                <summary class="font-semibold text-teal-900 p-3 cursor-pointer hover:bg-teal-50">Cosa significa * prima del nome?</summary>
                                <p class="text-teal-700 text-sm p-3 pt-0">Un asterisco <strong class="text-red-600">*</strong> indica che il dispositivo √® <strong>disabilitato</strong> (Status = Disabled).</p>
                            </details>

                            <details class="bg-white rounded-lg border border-teal-200">
                                <summary class="font-semibold text-teal-900 p-3 cursor-pointer hover:bg-teal-50">Come funzionano le porte del Patch Panel?</summary>
                                <p class="text-teal-700 text-sm p-3 pt-0">Ogni porta del patch panel pu√≤ avere fino a 2 connessioni (fronte e retro), permettendo di collegare wall jack e switch alla stessa porta.</p>
                            </details>

                            <details class="bg-white rounded-lg border border-teal-200">
                                <summary class="font-semibold text-teal-900 p-3 cursor-pointer hover:bg-teal-50">Pi√π persone possono usarlo insieme?</summary>
                                <p class="text-teal-700 text-sm p-3 pt-0">S√¨, ma attenzione: l'ultima persona a salvare sovrascriver√† le modifiche degli altri. Coordinarsi!</p>
                            </details>

                            <details class="bg-white rounded-lg border border-teal-200">
                                <summary class="font-semibold text-teal-900 p-3 cursor-pointer hover:bg-teal-50">Non vedo una porta che mi serve. Cosa faccio?</summary>
                                <p class="text-teal-700 text-sm p-3 pt-0">Vai alla scheda Devices, trova il dispositivo, clicca Edit e aggiungi pi√π porte con "+ Add Port Type".</p>
                            </details>

                            <details class="bg-white rounded-lg border border-teal-200">
                                <summary class="font-semibold text-teal-900 p-3 cursor-pointer hover:bg-teal-50">Come faccio backup dei dati?</summary>
                                <p class="text-teal-700 text-sm p-3 pt-0">Clicca "Export JSON" regolarmente e conserva il file in posto sicuro. Per ripristinare usa "Import JSON".</p>
                            </details>

                            <details class="bg-white rounded-lg border border-teal-200">
                                <summary class="font-semibold text-teal-900 p-3 cursor-pointer hover:bg-teal-50">Come associo dispositivi a una stanza?</summary>
                                <p class="text-teal-700 text-sm p-3 pt-0">Imposta il <strong>Nickname</strong> della stanza nel Floor Plan, poi modifica il dispositivo nella scheda Devices e imposta <strong>Location</strong> con lo stesso valore del Nickname.</p>
                            </details>

                            <details class="bg-white rounded-lg border border-teal-200">
                                <summary class="font-semibold text-teal-900 p-3 cursor-pointer hover:bg-teal-50">I dati vengono salvati automaticamente?</summary>
                                <p class="text-teal-700 text-sm p-3 pt-0">NO! Devi sempre cliccare <span class="bg-green-600 text-white px-2 py-0.5 rounded text-xs">üíæ Save Now</span> per salvare le modifiche sul server.</p>
                            </details>
                        </div>
                        <a href="#help-index" class="text-teal-600 text-xs mt-3 inline-block hover:underline">‚Üë Torna all'indice</a>
                    </div>

                    <!-- ========== FOOTER ========== -->
                    <div class="text-center text-slate-400 text-xs py-4 border-t border-slate-200 mt-6">
                        <p class="font-semibold text-slate-600">¬© 2026 Tiesse S.P.A. ‚Äî All rights reserved</p>
                        <p class="mt-1">TIESSE Matrix Network v3.4.0</p>
                        <p class="mt-2 text-red-500 font-medium">‚ö†Ô∏è Confidential document ‚Äî Reproduction prohibited ‚Äî For internal use only</p>
                    </div>
                </div>
            </div>

            <!-- Tab: SVG Topology with Cisco Icons -->
            <div id="content-drawio" class="tab-content">
                <!-- Header with all controls in one line -->
                <div class="flex items-center justify-between gap-4 mb-4 flex-wrap">
                    <!-- Left: Title + Stats -->
                    <div class="flex items-center gap-3">
                        <h2 class="text-xl font-bold text-slate-800">üó∫Ô∏è Network Topology</h2>
                        <div id="topologyStats" class="flex items-center gap-2 text-xs">
                            <!-- Stats populated by JS -->
                        </div>
                    </div>
                    
                    <!-- Right: Filters + Zoom + Actions -->
                    <div class="flex items-center gap-2 flex-wrap">
                        <!-- Filters -->
                        <select id="topologyLocationFilter" onchange="filterTopologyByLocation()" class="px-2 py-1.5 border border-slate-300 rounded-lg text-sm">
                            <option value="">üìç All Locations</option>
                        </select>
                        <select id="topologyRackFilter" onchange="filterTopologyByRack()" class="px-2 py-1.5 border border-slate-300 rounded-lg text-sm">
                            <option value="">üóÑÔ∏è All Groups</option>
                        </select>
                        <select id="drawioLayout" onchange="updateDrawioLayout()" class="px-2 py-1.5 border border-slate-300 rounded-lg text-sm">
                            <option value="auto">Auto Layout</option>
                            <option value="circle">Circle</option>
                            <option value="grid">Grid</option>
                            <option value="hierarchical">Hierarchical</option>
                        </select>
                        
                        <!-- Zoom/Fit Controls -->
                        <div class="flex items-center gap-1 border-l border-slate-300 pl-2">
                            <button onclick="fitDrawioView()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-1 px-2.5 rounded text-sm" title="Fit to View">üó∫Ô∏è Fit</button>
                            <button onclick="showTopologyLegend()" class="bg-purple-500 hover:bg-purple-600 text-white font-semibold py-1 px-2.5 rounded text-sm" title="Show Legend">üìã Legend</button>
                        </div>
                        
                        <!-- Export Actions -->
                        <div class="flex items-center gap-1 border-l border-slate-300 pl-2">
                            <button onclick="exportDrawioPNG()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-1 px-2.5 rounded-lg text-sm" title="Export as PNG">üì∑ PNG</button>
                            <button onclick="exportTopologyDrawio()" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-1 px-2.5 rounded-lg text-sm" title="Export as .drawio">üì• Drawio</button>
                        </div>
                    </div>
                </div>
                <div id="drawioContainer" class="border border-slate-300 rounded-xl bg-white" style="height: 600px; width: 100%; overflow: hidden; position: relative;">
                    <div class="flex items-center justify-center h-full text-slate-400">
                        <p>Loading topology visualization...</p>
                    </div>
                </div>

                <!-- Tip - Compact version -->
                <p class="mt-2 text-xs text-blue-600">üí° Drag devices to reposition ‚Ä¢ Export .drawio for <a href="https://app.diagrams.net" target="_blank" class="text-blue-700 hover:underline font-semibold">diagrams.net</a> ‚Ä¢ PNG includes title & date</p>
            </div>

            <!-- Tab 6: Activity Logs -->
            <div id="content-logs" class="tab-content">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h2 class="text-xl font-bold text-slate-800">üìã Activity Logs</h2>
                        <p class="text-xs text-slate-500">Last 200 changes</p>
                    </div>
                    <div class="flex gap-2">
                        <select id="logFilter" onchange="filterLogs()" class="px-3 py-1.5 border border-slate-300 rounded-lg text-sm">
                            <option value="">All Activities</option>
                            <option value="device">Devices</option>
                            <option value="connection">Connections</option>
                            <option value="import">Import/Export</option>
                            <option value="auth">Authentication</option>
                        </select>
                        <button onclick="clearLogs()" class="edit-mode-only bg-red-500 hover:bg-red-600 text-white font-semibold py-1.5 px-3 rounded-lg text-sm" style="display:none;">
                            üóëÔ∏è Clear Logs
                        </button>
                        <button onclick="exportLogs()" class="bg-slate-500 hover:bg-slate-600 text-white font-semibold py-1.5 px-3 rounded-lg text-sm">
                            üì• Export Logs
                        </button>
                    </div>
                </div>
                <div id="logsContainer" class="border border-slate-200 rounded-xl overflow-hidden">
                    <table class="w-full text-sm">
                        <thead class="bg-slate-100">
                            <tr>
                                <th class="px-3 py-2 text-left font-semibold text-slate-700 w-40">Timestamp</th>
                                <th class="px-3 py-2 text-left font-semibold text-slate-700 w-24">Action</th>
                                <th class="px-3 py-2 text-left font-semibold text-slate-700 w-24">Type</th>
                                <th class="px-3 py-2 text-left font-semibold text-slate-700">Details</th>
                                <th class="px-3 py-2 text-left font-semibold text-slate-700 w-24">User</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody" class="divide-y divide-slate-100">
                            <tr><td colspan="5" class="px-3 py-8 text-center text-slate-400">No logs yet</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm mx-4">
            <div class="text-center mb-6">
                <h2 class="text-xl font-bold text-slate-800">üîê Edit Mode Access</h2>
                <p class="text-sm text-slate-500 mt-1">Enter your credentials to edit</p>
            </div>
            <form id="loginForm" onsubmit="Auth.handleLoginSubmit(event)">
                <div class="space-y-4">
                    <div>
                        <label for="loginUsername" class="block text-sm font-medium text-slate-700 mb-1">Username</label>
                        <input type="text" id="loginUsername" name="username" required autocomplete="username"
                            class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="loginPassword" class="block text-sm font-medium text-slate-700 mb-1">Password</label>
                        <input type="password" id="loginPassword" name="password" required autocomplete="current-password"
                            class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div id="loginError" class="text-red-500 text-sm text-center hidden"></div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button type="button" onclick="Auth.hideLoginModal()"
                        class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-2 px-4 rounded-lg">
                        Cancel
                    </button>
                    <button type="submit" id="loginSubmitBtn"
                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg">
                        Login
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Legend Modal -->
    <div id="legendModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" onclick="closeLegendModal(event)">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-[90vw] max-w-6xl max-h-[90vh] overflow-y-auto mx-4" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800">üìã Network Topology Overview</h2>
                <button onclick="closeLegendModal()" class="text-slate-400 hover:text-slate-600 text-3xl font-bold leading-none">&times;</button>
            </div>
            <div id="legendModalContent">
                <!-- Content will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Load external JavaScript modules with cache-buster -->
    <script src="js/auth.js?v=3.4.0"></script>
    <script src="js/app.js?v=3.4.0"></script>
    <script src="js/ui-updates.js?v=3.4.0"></script>
    <script src="js/features.js?v=3.4.0"></script>
    <script src="js/floorplan.js?v=3.4.0"></script>
    
    <!-- Update connections count when list lists -->
    <script>
        (function() {
            var origUpdateConnList = window.updateConnectionsList;
            window.updateConnectionsList = function() {
                origUpdateConnList.apply(this, arguments);
                var countEl = document.getElementById('connectionsCount');
                if (countEl && window.appState) {
                    countEl.textContent = appState.connections.length;
                }
                // Update location filter
                if (typeof LocationFilter !== 'undefined') {
                    LocationFilter.update();
                }
            };
            
            var origUpdateDevList = window.updateDevicesList;
            window.updateDevicesList = function() {
                origUpdateDevList.apply(this, arguments);
                // Update location filter
                if (typeof LocationFilter !== 'undefined') {
                    LocationFilter.update();
                }
            };
        })();
    </script>

</body>
</html>
